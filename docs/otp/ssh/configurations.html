<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.30.9">
    <meta name="project" content="ssh v5.0.1">


    <title>Configuration in SSH — ssh v5.0.1</title>
    <link rel="stylesheet" href="dist/html-erlang-QW5RMTQD.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-43PMFBC7.js"></script>
    <script src="dist/sidebar_items-268FE5F3.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/html-LRUIU55G.js"></script>

<style>.dark img { background-color: white; }</style>
  </head>
  <body data-type="extras" class="page-extra">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">

<button class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="api-reference.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="ssh" />
        </a>

      <div>
        <a href="api-reference.html" class="sidebar-projectName" translate="no">
ssh
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v5.0.1
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">
      <div class="top-search">
        <div class="search-settings">
          <form class="search-bar" action="search.html">
            <label class="search-label">
              <span class="sr-only">Search documentation of ssh</span>
              <input name="q" type="text" class="search-input" placeholder="Search Documentation (press /)" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
            </label>
            <button type="submit" class="search-button" aria-label="Submit Search">
              <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
            </button>
            <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
              <i class="ri-close-line ri-lg" title="Cancel search"></i>
            </button>
          </form>
          <button class="icon-settings display-settings">
            <i class="ri-settings-3-line"></i>
            <span class="sr-only">Settings</span>
          </button>
        </div>
      </div>
      <div class="autocomplete">
        <div class="autocomplete-results">
        </div>
      </div>

<h1>

    <a href="https://github.com/erlang/otp/blob/master/lib/ssh/doc/guides/configurations.md#L1" title="View Source" class="icon-action" rel="help">
      <i class="ri-code-s-slash-line" aria-hidden="true"></i>
      <span class="sr-only">View Source</span>
    </a>


  <span>Configuration in SSH</span>
</h1>

<p><a href="" id="introduction"></a></p><h2 id="introduction" class="section-heading">
  <a href="#introduction" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Introduction</span>
</h2>
<p>The OTP SSH app can be configurated by a large amount of <em>Options</em>. This chapter
will not go into details of what each of the options does. It will however
describe and define different ways by which they could be entered.</p><p>Options for hardening are described in the <a href="hardening.html">Hardening SSH</a>
chapter. How the options for algorithm configuration interact are described in
the <a href="configure_algos.html">Configuring algorithms in SSH</a> chapter.</p><h2 id="options-configuration" class="section-heading">
  <a href="#options-configuration" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Options configuration</span>
</h2>
<p>There are from OTP-23.0 two main ways to set an option:</p><ul><li><p>Like before, in the <code class="inline">Options</code> parameter in the Erlang code in a call to for
example <a href="ssh.html#daemon/3"><code class="inline">ssh:daemon/3</code></a> or <a href="ssh.html#connect/3"><code class="inline">ssh:connect/3</code></a> or any of their variants. Example:</p><pre><code class="text">ssh:connect(22, [{user,&quot;foo&quot;}])</code></pre></li><li><p>In <a href="../../../../lib/kernel/doc/html/config.html">OTP Configuration Parameters</a>:</p><ul><li><p>In the erl command line:</p><pre><code class="text">erl -ssh user \&quot;foo\&quot;</code></pre></li><li><p>In the <code class="inline">ssh.app</code> file, in the <code class="inline">env</code> part</p><pre><code class="text">{application, ssh,
 [{description, &quot;SSH-2 for Erlang/OTP&quot;},
  {vsn, &quot;4.9&quot;},
  {modules, [ssh,
        ...
         ssh_xfer]},
  {registered, []},
  {applications, [kernel, stdlib, crypto, public_key]},
  {env, [{user, &quot;bar&quot;]}, % &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; HERE
  {mod, {ssh_app, []}},
       ...</code></pre></li><li><p>In a .config file:</p><pre><code class="text">erl -config ex1</code></pre><p>where <code class="inline">ex1.config</code> contains:</p><pre><code class="text">[
{ssh, [{user, &quot;foo&quot;}]}
].</code></pre></li></ul><p>If the option is intended only for a server or for a client, it may be set in
this way:</p><pre><code class="text">[
{ssh, [{server_options,[{user, &quot;foo&quot;}]},
       {client_options,[{user, &quot;bar&quot;}]}
].</code></pre><p>A server (daemon) will use the user name <code class="inline">foo</code>, and a client will use the name
<code class="inline">bar</code>.</p></li></ul><h2 id="precedens" class="section-heading">
  <a href="#precedens" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Precedens</span>
</h2>
<p>If an option is set in more than one way, what happens?</p><p>There is an ordering, which is:</p><ul><li>Level 0: Hard-coded default values in the OTP SSH source code</li><li>Level 1: <a href="../../../../lib/kernel/doc/html/config.html">OTP Configuration Parameters</a></li><li>Level 2: Options in the <a href="../../../../lib/kernel/doc/html/config.html">OTP Configuration Parameters</a>
<code class="inline">server_options</code> or <code class="inline">client_options</code></li><li>Level 3: Options in argument list to a function</li></ul><p>If the same option is set at two different levels, the one at the highest level
is used.</p><p>The only exception is the
<a href="ssh.html#t:modify_algorithms_common_option/0">modify_algorithms</a> common option.
They are all applied in ascending level order on the set of algorithms. So a
<code class="inline">modify_algorithms</code> on level one is applied before one of level two and so on.</p><p>If there is an
<a href="ssh.html#t:preferred_algorithms_common_option/0">preferred_algorithms</a> option on
some level the whole set is replaced by that in that option and <em>all
modify_algorithms are applied</em> in level ordering.</p><p>The reason for applying all
<a href="ssh.html#t:modify_algorithms_common_option/0">modify_algorithms</a> in level order,
is to enable the user to add an algorithm that has been removed from the default
set without code changes, only by adding an option in a config file. This can be
used to interoperate with legacy systems that still uses algorithms no longer
considered secure enough to be supported by default.</p><h3 id="algorithm-configuration" class="section-heading">
  <a href="#algorithm-configuration" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Algorithm configuration</span>
</h3>
<p>There is a <a href="configure_algos.html#introduction">separate chapter</a> about how
<a href="ssh.html#t:preferred_algorithms_common_option/0">preferred_algorithms</a> and
<a href="ssh.html#t:modify_algorithms_common_option/0">modify_algorithms</a> co-operate. How
the different configuration levels affect them, is described here in this
section.</p><h4>The ssh:start/0 function</h4><p>If the application SSH is <em>not</em> <a href="ssh.html#start/0">started</a>, the command
<a href="ssh.html#default_algorithms/0"><code class="inline">ssh:default_algorithms/0</code></a> delivers the list of default (hardcoded) algorithms
with respect to the support in the current cryptolib.</p><p>If the application SSH <em>is</em> <a href="ssh.html#start/0">started</a>, the command
<a href="ssh.html#default_algorithms/0"><code class="inline">ssh:default_algorithms/0</code></a> delvers the list of algorithms after application of
level 0 and level 1 configurations.</p><p>Here is an example. The config-file has the following contents:</p><pre><code class="text">$ cat ex2.config
[
 {ssh, [{preferred_algorithms, [{cipher, ['aes192-ctr']},
       			        {public_key, ['ssh-rsa']},
                                {kex, ['ecdh-sha2-nistp384']},
                                {mac, ['hmac-sha1']}]}]}
].</code></pre><p>Erlang is started with <code class="inline">ex2.config</code> as configuration and we check the default
set of algorithms before starting ssh:</p><pre><code class="text">$ erl -config ex2
Erlang/OTP 23 [RELEASE CANDIDATE 1] [erts-10.6.4] [source-96a0823109] [64-bit] [smp:4:4] [ds:4:4:10] [async-threads:1] [hipe]

Eshell V10.6.4  (abort with ^G)
1&gt; ssh:default_algorithms().
[{kex,['ecdh-sha2-nistp384','ecdh-sha2-nistp521',
       'ecdh-sha2-nistp256','diffie-hellman-group-exchange-sha256',
       'diffie-hellman-group16-sha512',
       'diffie-hellman-group18-sha512',
       'diffie-hellman-group14-sha256','curve25519-sha256',
       'curve25519-sha256@libssh.org','curve448-sha512',
       'diffie-hellman-group14-sha1',
       'diffie-hellman-group-exchange-sha1']},
 {public_key,['ecdsa-sha2-nistp384','ecdsa-sha2-nistp521',
              'ecdsa-sha2-nistp256','ssh-ed25519','ssh-ed448','ssh-rsa',
              'rsa-sha2-256','rsa-sha2-512','ssh-dss']},
 {cipher,[{client2server,['chacha20-poly1305@openssh.com',
                          'aes256-gcm@openssh.com','aes256-ctr','aes192-ctr',
                          'aes128-gcm@openssh.com','aes128-ctr','aes256-cbc',
                          'aes192-cbc','aes128-cbc','3des-cbc']},
          {server2client,['chacha20-poly1305@openssh.com',
                          'aes256-gcm@openssh.com','aes256-ctr','aes192-ctr',
                          'aes128-gcm@openssh.com','aes128-ctr','aes256-cbc',
                          'aes192-cbc','aes128-cbc','3des-cbc']}]},
 {mac,[{client2server,['hmac-sha2-256','hmac-sha2-512',
                       'hmac-sha1']},
       {server2client,['hmac-sha2-256','hmac-sha2-512',
                       'hmac-sha1']}]},
 {compression,[{client2server,[none,'zlib@openssh.com',zlib]},
               {server2client,[none,'zlib@openssh.com',zlib]}]}]</code></pre><p>Note that the algorithms in the file <code class="inline">ex2.config</code> is not yet applied. They will
be when we start ssh:</p><pre><code class="text">2&gt; ssh:start().
ok
3&gt; ssh:default_algorithms().
[{kex,['ecdh-sha2-nistp384']},
 {public_key,['ssh-rsa']},
 {cipher,[{client2server,['aes192-ctr']},
          {server2client,['aes192-ctr']}]},
 {mac,[{client2server,['hmac-sha1']},
       {server2client,['hmac-sha1']}]},
 {compression,[{client2server,[none,'zlib@openssh.com',zlib]},
               {server2client,[none,'zlib@openssh.com',zlib]}]}]
4&gt;</code></pre><p>We see that the algorithm set is changed to the one in the <code class="inline">ex2.config</code>. Since
<code class="inline">compression</code> is not specified in the file, the hard-coded default is still used
for that entry.</p><h4>Establishing a connection (ssh:connect et al) or starting a daemon (ssh:daemon)</h4><p>Both when the client establishes a connection with ssh:connect or other
functions, or a daemon is started with ssh:daemon, the option lists in the
function calls are also used.</p><p>If a client is started (ssh:connect et al), the environment variable
<code class="inline">client_options</code> is used. Similarly for a daemon the <code class="inline">server_options</code> variable
is handled.</p><p>If any <a href="ssh.html#t:preferred_algorithms_common_option/0">preferred_algorithms</a> is
present, the one with the highest level is used, that is, the <code class="inline">Option</code> list
parameter has the highest priority. Then the
<a href="ssh.html#t:modify_algorithms_common_option/0">modify_algorithms</a> on all levels in
order starting with level 0 are applied.</p><p>We continue the example above by connecting to a server and modifying the <code class="inline">kex</code>
algorithm set. We remove the only one (<code class="inline">'ecdh-sha2-nistp384'</code>) and add
<code class="inline">'curve25519-sha256@libssh.org'</code> by appending it to the now empty list:</p><pre><code class="text">4&gt; {ok,C} = ssh:connect(loopback, 22,
                        [{modify_algorithms,
                                 [{rm,
                                     [ {kex,['ecdh-sha2-nistp384']} ]
				  },
                                  {append,
			             [ {kex,['curve25519-sha256@libssh.org']} ]
				  }
				 ]
	                 }
                        ]).
{ok,&gt;0.118.0&gt;}</code></pre><p>We check which algorithms are negotiated by the client and the server, and note
that the (only) <code class="inline">kex</code> algorithm <code class="inline">'curve25519-sha256@libssh.org'</code> was selected:</p><pre><code class="text">5&gt; ssh:connection_info(C, algorithms).
{algorithms,[{kex,'curve25519-sha256@libssh.org'},
             {hkey,'ssh-rsa'},
             {send_mac,'hmac-sha1'},
             {recv_mac,'hmac-sha1'},
             {encrypt,'aes192-ctr'},
             {decrypt,'aes192-ctr'},
             {compress,none},
             {decompress,none},
             {send_ext_info,false},
             {recv_ext_info,true}]}</code></pre><h4>Example of modify_algorithms handling</h4><p>We will now check if the
<a href="ssh.html#t:modify_algorithms_common_option/0">modify_algorithms</a> on a lower level
is applied to a
<a href="ssh.html#t:preferred_algorithms_common_option/0">preferred_algorithms</a> on a higher
level. We will do that by enabling the <code class="inline">ssh-dss</code> algorithm that is supported,
but not in the default set.</p><p>The config file <code class="inline">ex3.config</code> has the contents:</p><pre><code class="text">[
 {ssh, [{modify_algorithms,
         [ {prepend, [{public_key, ['ssh-dss']}]} ]
        }]}
].</code></pre><p>A newly started erlang shell shows that no <code class="inline">'ssh-dss'</code> is present in the
<code class="inline">public_key</code> entry:</p><pre><code class="text">1&gt; proplists:get_value(public_key, ssh:default_algorithms()).
['ecdsa-sha2-nistp384','ecdsa-sha2-nistp521',
 'ecdsa-sha2-nistp256','ssh-ed25519','ssh-ed448',
 'rsa-sha2-256','rsa-sha2-512','ssh-rsa']
2&gt;</code></pre><p>A call to <a href="ssh.html#connect/3"><code class="inline">ssh:connect/3</code></a> removes all algorithms but one of each type:</p><pre><code class="text">2&gt; ssh:start().
ok
3&gt; {ok,C} = ssh:connect(loopback, 22,
                        [{preferred_algorithms,
                         [{public_key, ['ecdsa-sha2-nistp256']},
			  {kex, ['ecdh-sha2-nistp256']},
		          {cipher, ['chacha20-poly1305@openssh.com']},
			  {mac, ['hmac-sha2-256']},
			  {compression, [none]}
			  ]}
			 ]).
{ok,&lt;0.101.0&gt;}
4&gt; ssh:connection_info(C,algorithms).
{algorithms,[{kex,'ecdh-sha2-nistp256'},
             {hkey,'ssh-dss'},
             {send_mac,'chacha20-poly1305@openssh.com'},
             {recv_mac,'chacha20-poly1305@openssh.com'},
             {encrypt,'chacha20-poly1305@openssh.com'},
             {decrypt,'chacha20-poly1305@openssh.com'},
             {compress,none},
             {decompress,none},
             {send_ext_info,false},
             {recv_ext_info,true}]}
5&gt;</code></pre><p>But <code class="inline">'ssh-dss'</code> is selected although the call inserted <em>only</em>
<code class="inline">'ecdsa-sha2-nistp256'</code> as acceptable.</p><p>This example showed that we could augment the set of algorithms with a
config-file without the need to change the actual call.</p><p>For demonstration purposes we used <code class="inline">prepend</code> instead of <code class="inline">append</code>. This forces
the negotiation to select <code class="inline">ssh-dss</code> since the the full list of public key
algorithms was <code class="inline">['ssh-dss','ecdsa-sha2-nistp256']</code>. Normally it is safer to
append a non-default algorithm.</p>
<div class="bottom-actions">
  <div class="bottom-actions-item">

      <a href="terminology.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Terminology
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="configure_algos.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Configuring algorithms in SSH
        </span>
      </a>

  </div>
</div>
      <footer class="footer">
        <p>

          <span class="line">
            <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
              Search HexDocs
            </button>

          </span>
        </p>

        <p class="built-using">
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.30.9) for the

            <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

        </p>
      </footer>
    </div>
  </div>
</main>
</div>


  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.30.9">
    <meta name="project" content="et v1.7">


    <title>Advanced examples — et v1.7</title>
    <link rel="stylesheet" href="dist/html-erlang-QW5RMTQD.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-43PMFBC7.js"></script>
    <script src="dist/sidebar_items-0A680435.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/html-LRUIU55G.js"></script>

<style>.dark img { background-color: white; }</style>
  </head>
  <body data-type="extras" class="page-extra">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">

<button class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="api-reference.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="et" />
        </a>

      <div>
        <a href="api-reference.html" class="sidebar-projectName" translate="no">
et
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v1.7
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">
      <div class="top-search">
        <div class="search-settings">
          <form class="search-bar" action="search.html">
            <label class="search-label">
              <span class="sr-only">Search documentation of et</span>
              <input name="q" type="text" class="search-input" placeholder="Search Documentation (press /)" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
            </label>
            <button type="submit" class="search-button" aria-label="Submit Search">
              <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
            </button>
            <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
              <i class="ri-close-line ri-lg" title="Cancel search"></i>
            </button>
          </form>
          <button class="icon-settings display-settings">
            <i class="ri-settings-3-line"></i>
            <span class="sr-only">Settings</span>
          </button>
        </div>
      </div>
      <div class="autocomplete">
        <div class="autocomplete-results">
        </div>
      </div>

<h1>

    <a href="https://github.com/erlang/otp/blob/master/lib/et/doc/guides/et_examples.md#L1" title="View Source" class="icon-action" rel="help">
      <i class="ri-code-s-slash-line" aria-hidden="true"></i>
      <span class="sr-only">View Source</span>
    </a>


  <span>Advanced examples</span>
</h1>

<h2 id="a-simulated-mnesia-transaction" class="section-heading">
  <a href="#a-simulated-mnesia-transaction" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">A simulated Mnesia transaction</span>
</h2>
<p>The Erlang code for running the simulated <code class="inline">Mnesia</code> transaction example in the
previous chapter is included in the <code class="inline">et/examples/et_demo.erl</code> file:</p><pre><code class="makeup erlang" translate="no"><span class="w">
</span><span class="nf">sim_trans</span><span class="p" data-group-id="2480911118-1">(</span><span class="p" data-group-id="2480911118-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nf">sim_trans</span><span class="p" data-group-id="2480911118-2">(</span><span class="p" data-group-id="2480911118-3">[</span><span class="p" data-group-id="2480911118-3">]</span><span class="p" data-group-id="2480911118-2">)</span><span class="p">.</span><span class="w">

</span><span class="nf">sim_trans</span><span class="p" data-group-id="2480911118-4">(</span><span class="n">ExtraOptions</span><span class="p" data-group-id="2480911118-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2480911118-5">[</span><span class="p" data-group-id="2480911118-6">{</span><span class="ss">dict_insert</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2480911118-7">{</span><span class="ss">filter</span><span class="p">,</span><span class="w"> </span><span class="ss">mgr_actors</span><span class="p" data-group-id="2480911118-7">}</span><span class="p">,</span><span class="w"> </span><span class="k">fun</span><span class="w"> </span><span class="ss">mgr_actors</span><span class="p">/</span><span class="mi">1</span><span class="p" data-group-id="2480911118-6">}</span><span class="p" data-group-id="2480911118-5">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2480911118-8">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Viewer</span><span class="p" data-group-id="2480911118-8">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">et_viewer</span><span class="p">:</span><span class="nf">start_link</span><span class="p" data-group-id="2480911118-9">(</span><span class="n">Options</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">ExtraOptions</span><span class="p" data-group-id="2480911118-9">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Collector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">et_viewer</span><span class="p">:</span><span class="nf">get_collector_pid</span><span class="p" data-group-id="2480911118-10">(</span><span class="n">Viewer</span><span class="p" data-group-id="2480911118-10">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">et_collector</span><span class="p">:</span><span class="nf">report_event</span><span class="p" data-group-id="2480911118-11">(</span><span class="n">Collector</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="p">,</span><span class="w"> </span><span class="ss">my_shell</span><span class="p">,</span><span class="w"> </span><span class="ss">mnesia_tm</span><span class="p">,</span><span class="w"> </span><span class="ss">start_outer</span><span class="p">,</span><span class="w">
                              </span><span class="s">&quot;Start outer transaction&quot;</span><span class="p" data-group-id="2480911118-11">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">et_collector</span><span class="p">:</span><span class="nf">report_event</span><span class="p" data-group-id="2480911118-12">(</span><span class="n">Collector</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="ss">mnesia_tm</span><span class="p">,</span><span class="w"> </span><span class="ss">my_shell</span><span class="p">,</span><span class="w"> </span><span class="ss">new_tid</span><span class="p">,</span><span class="w">
                              </span><span class="s">&quot;New transaction id is 4711&quot;</span><span class="p" data-group-id="2480911118-12">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">et_collector</span><span class="p">:</span><span class="nf">report_event</span><span class="p" data-group-id="2480911118-13">(</span><span class="n">Collector</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="ss">my_shell</span><span class="p">,</span><span class="w"> </span><span class="ss">mnesia_locker</span><span class="p">,</span><span class="w"> </span><span class="ss">try_write_lock</span><span class="p">,</span><span class="w">
                              </span><span class="s">&quot;Acquire write lock for {my_tab, key}&quot;</span><span class="p" data-group-id="2480911118-13">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">et_collector</span><span class="p">:</span><span class="nf">report_event</span><span class="p" data-group-id="2480911118-14">(</span><span class="n">Collector</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="ss">mnesia_locker</span><span class="p">,</span><span class="w"> </span><span class="ss">my_shell</span><span class="p">,</span><span class="w"> </span><span class="ss">granted</span><span class="p">,</span><span class="w">
                              </span><span class="s">&quot;You got the write lock for {my_tab, key}&quot;</span><span class="p" data-group-id="2480911118-14">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">et_collector</span><span class="p">:</span><span class="nf">report_event</span><span class="p" data-group-id="2480911118-15">(</span><span class="n">Collector</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="p">,</span><span class="w"> </span><span class="ss">my_shell</span><span class="p">,</span><span class="w"> </span><span class="ss">do_commit</span><span class="p">,</span><span class="w">
                              </span><span class="s">&quot;Perform  transaction commit&quot;</span><span class="p" data-group-id="2480911118-15">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">et_collector</span><span class="p">:</span><span class="nf">report_event</span><span class="p" data-group-id="2480911118-16">(</span><span class="n">Collector</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="ss">my_shell</span><span class="p">,</span><span class="w"> </span><span class="ss">mnesia_locker</span><span class="p">,</span><span class="w"> </span><span class="ss">release_tid</span><span class="p">,</span><span class="w">
                              </span><span class="s">&quot;Release all locks for transaction 4711&quot;</span><span class="p" data-group-id="2480911118-16">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">et_collector</span><span class="p">:</span><span class="nf">report_event</span><span class="p" data-group-id="2480911118-17">(</span><span class="n">Collector</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="p">,</span><span class="w"> </span><span class="ss">my_shell</span><span class="p">,</span><span class="w"> </span><span class="ss">mnesia_tm</span><span class="p">,</span><span class="w"> </span><span class="ss">delete_transaction</span><span class="p">,</span><span class="w">
                              </span><span class="s">&quot;End of outer transaction&quot;</span><span class="p" data-group-id="2480911118-17">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">et_collector</span><span class="p">:</span><span class="nf">report_event</span><span class="p" data-group-id="2480911118-18">(</span><span class="n">Collector</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="ss">my_shell</span><span class="p">,</span><span class="w"> </span><span class="ss">end_outer</span><span class="p">,</span><span class="w">
                              </span><span class="s">&quot;Transaction returned {atomic, ok}&quot;</span><span class="p" data-group-id="2480911118-18">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2480911118-19">{</span><span class="ss">collector</span><span class="p">,</span><span class="w"> </span><span class="n">Collector</span><span class="p" data-group-id="2480911118-19">}</span><span class="p">.</span></code></pre><pre><code class="makeup erlang" translate="no"><span class="w">
</span><span class="nf">mgr_actors</span><span class="p" data-group-id="8496977679-1">(</span><span class="n">E</span><span class="p" data-group-id="8496977679-1">)</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="nf">is_record</span><span class="p" data-group-id="8496977679-2">(</span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="ss">event</span><span class="p" data-group-id="8496977679-2">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Actor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="8496977679-3">(</span><span class="n">A</span><span class="p" data-group-id="8496977679-3">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
               </span><span class="k">case</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="k">of</span><span class="w">
                   </span><span class="ss">mnesia_tm</span><span class="w">     </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">trans_mgr</span><span class="p">;</span><span class="w">
                   </span><span class="ss">mnesia_locker</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">lock_mgr</span><span class="p">;</span><span class="w">
                   </span><span class="p">_</span><span class="w">             </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">A</span><span class="w">
               </span><span class="k">end</span><span class="w">
            </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="8496977679-4">{</span><span class="ss">true</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="o">#</span><span class="ss">event</span><span class="p" data-group-id="8496977679-5">{</span><span class="ss">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Actor</span><span class="p" data-group-id="8496977679-6">(</span><span class="n">E</span><span class="o">#</span><span class="ss">event</span><span class="p">.</span><span class="ss">from</span><span class="p" data-group-id="8496977679-6">)</span><span class="p">,</span><span class="w">
                   </span><span class="ss">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Actor</span><span class="p" data-group-id="8496977679-7">(</span><span class="n">E</span><span class="o">#</span><span class="ss">event</span><span class="p">.</span><span class="ss">to</span><span class="p" data-group-id="8496977679-7">)</span><span class="p">,</span><span class="w">
                   </span><span class="ss">contents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8496977679-8">[</span><span class="p" data-group-id="8496977679-9">{</span><span class="ss">orig_from</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="o">#</span><span class="ss">event</span><span class="p">.</span><span class="ss">from</span><span class="p" data-group-id="8496977679-9">}</span><span class="p">,</span><span class="w">
                               </span><span class="p" data-group-id="8496977679-10">{</span><span class="ss">orig_to</span><span class="p">,</span><span class="w">   </span><span class="n">E</span><span class="o">#</span><span class="ss">event</span><span class="p">.</span><span class="ss">to</span><span class="p" data-group-id="8496977679-10">}</span><span class="p">,</span><span class="w">
                               </span><span class="p" data-group-id="8496977679-11">{</span><span class="ss">orig_contents</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="o">#</span><span class="ss">event</span><span class="p">.</span><span class="ss">contents</span><span class="p" data-group-id="8496977679-11">}</span><span class="p" data-group-id="8496977679-8">]</span><span class="p" data-group-id="8496977679-5">}</span><span class="p" data-group-id="8496977679-4">}</span><span class="p">.</span></code></pre><p>If you invoke the <code class="inline">et_demo:sim_trans()</code> function, a <code class="inline">Viewer</code> window will pop up
and the sequence trace will be almost the same as if the following <code class="inline">Mnesia</code>
transaction would have been run:</p><pre><code class="text">mnesia:transaction(fun() -&gt; mnesia:write({my_tab, key, val}) end).</code></pre><p>And the viewer window will look like:</p><pre><code class="text">Erlang R13B03 (erts-5.7.4) [64-bit] [smp:4:4] [rq:4] [async-threads:0] [kernel-poll:false]

Eshell V5.7.4  (abort with ^G)
1&gt; {ok, Viewer} = et_viewer:start([]).
{ok,&lt;0.40.0&gt;;}
2&gt; et_demo:sim_trans().
{ok,{table_handle,&lt;0.45.0&gt;,24596,trace_ts,
     #Fun&lt;et_collector.0.62831470&gt;}}</code></pre><p><img src="assets/sim_trans.png" alt="A simulated Mnesia transaction which writes one record" title="A simulated Mnesia transaction which writes one record"/></p><h2 id="some-convenient-functions-used-in-the-mnesia-transaction-example" class="section-heading">
  <a href="#some-convenient-functions-used-in-the-mnesia-transaction-example" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Some convenient functions used in the Mnesia transaction example</span>
</h2>
<p>The <code class="inline">module_as_actor</code> filter converts the <code class="inline">Event Records</code> so the module names
becomes actors and the invoked functions becomes labels. If the information
about who the caller was it will be displayed as an arrow directed from the
caller to the callee. The <code class="inline">[{message, {caller}}, {return_trace}]</code> options to
<a href="../../../../lib/runtime_tools/doc/html/dbg.html#tpl/2"><code class="inline">dbg:tpl/2</code></a> function will imply the necessary information in the Erlang traces.
Here follows the <code class="inline">module_as_actor</code> filter:</p><pre><code class="makeup erlang" translate="no"><span class="w">
</span><span class="nf">module_as_actor</span><span class="p" data-group-id="4096680178-1">(</span><span class="n">E</span><span class="p" data-group-id="4096680178-1">)</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="nf">is_record</span><span class="p" data-group-id="4096680178-2">(</span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="ss">event</span><span class="p" data-group-id="4096680178-2">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4096680178-3">(</span><span class="ss">mfa</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="o">#</span><span class="ss">event</span><span class="p">.</span><span class="ss">contents</span><span class="p" data-group-id="4096680178-3">)</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="p" data-group-id="4096680178-4">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4096680178-5">{</span><span class="ss">mfa</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4096680178-6">{</span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">A</span><span class="p" data-group-id="4096680178-6">}</span><span class="p" data-group-id="4096680178-5">}</span><span class="p" data-group-id="4096680178-4">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="k">case</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="4096680178-7">(</span><span class="ss">pam_result</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="o">#</span><span class="ss">event</span><span class="p">.</span><span class="ss">contents</span><span class="p" data-group-id="4096680178-7">)</span><span class="w"> </span><span class="k">of</span><span class="w">
                </span><span class="p" data-group-id="4096680178-8">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4096680178-9">{</span><span class="ss">pam_result</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4096680178-10">{</span><span class="n">M2</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">F2</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">A2</span><span class="p" data-group-id="4096680178-10">}</span><span class="p" data-group-id="4096680178-9">}</span><span class="p" data-group-id="4096680178-8">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                    </span><span class="p" data-group-id="4096680178-11">{</span><span class="ss">true</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="o">#</span><span class="ss">event</span><span class="p" data-group-id="4096680178-12">{</span><span class="ss">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="ss">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M2</span><span class="p">,</span><span class="w"> </span><span class="ss">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="p" data-group-id="4096680178-12">}</span><span class="p" data-group-id="4096680178-11">}</span><span class="p">;</span><span class="w">
                </span><span class="p">_</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                    </span><span class="p" data-group-id="4096680178-13">{</span><span class="ss">true</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="o">#</span><span class="ss">event</span><span class="p" data-group-id="4096680178-14">{</span><span class="ss">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="ss">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="ss">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="p" data-group-id="4096680178-14">}</span><span class="p" data-group-id="4096680178-13">}</span><span class="w">
            </span><span class="k">end</span><span class="p">;</span><span class="w">
        </span><span class="p">_</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">false</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span></code></pre><p>The <code class="inline">plain_process_info</code> filter does not alter the <code class="inline">Event Records</code>. It merely
ensures that the event not related to processes are skipped:</p><pre><code class="makeup erlang" translate="no"><span class="w">
</span><span class="nf">plain_process_info</span><span class="p" data-group-id="7472293450-1">(</span><span class="n">E</span><span class="p" data-group-id="7472293450-1">)</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="nf">is_record</span><span class="p" data-group-id="7472293450-2">(</span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="ss">event</span><span class="p" data-group-id="7472293450-2">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">E</span><span class="o">#</span><span class="ss">event</span><span class="p">.</span><span class="ss">label</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="nb">send</span><span class="w">                          </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">true</span><span class="p">;</span><span class="w">
        </span><span class="ss">send_to_non_existing_process</span><span class="w">  </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">true</span><span class="p">;</span><span class="w">
        </span><span class="ss">&#39;receive&#39;</span><span class="w">                     </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">true</span><span class="p">;</span><span class="w">
        </span><span class="nb">spawn</span><span class="w">                         </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">true</span><span class="p">;</span><span class="w">
        </span><span class="nb">exit</span><span class="w">                          </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">true</span><span class="p">;</span><span class="w">
        </span><span class="nb">link</span><span class="w">                          </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">true</span><span class="p">;</span><span class="w">
        </span><span class="nb">unlink</span><span class="w">                        </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">true</span><span class="p">;</span><span class="w">
        </span><span class="ss">getting_linked</span><span class="w">                </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">true</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7472293450-3">{</span><span class="ss">seq_send</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">Label</span><span class="p" data-group-id="7472293450-3">}</span><span class="w">            </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">true</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7472293450-4">{</span><span class="ss">seq_receive</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">Label</span><span class="p" data-group-id="7472293450-4">}</span><span class="w">         </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">true</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7472293450-5">{</span><span class="ss">seq_print</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">Label</span><span class="p" data-group-id="7472293450-5">}</span><span class="w">           </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">true</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="7472293450-6">{</span><span class="ss">drop</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">N</span><span class="p" data-group-id="7472293450-6">}</span><span class="w">                    </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">true</span><span class="p">;</span><span class="w">
        </span><span class="p">_</span><span class="w">                             </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">false</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span></code></pre><p>The <code class="inline">plain_process_info_nolink</code> filter does not alter the <code class="inline">Event Records</code>. It do
makes use of the <code class="inline">plain_process_info</code> , but do also ensure that the process info
related to linking and unlinking is skipped:</p><pre><code class="makeup erlang" translate="no"><span class="w">
</span><span class="nf">plain_process_info_nolink</span><span class="p" data-group-id="7456960729-1">(</span><span class="n">E</span><span class="p" data-group-id="7456960729-1">)</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="nf">is_record</span><span class="p" data-group-id="7456960729-2">(</span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="ss">event</span><span class="p" data-group-id="7456960729-2">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7456960729-3">(</span><span class="n">E</span><span class="o">#</span><span class="ss">event</span><span class="p">.</span><span class="ss">label</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="nb">link</span><span class="p" data-group-id="7456960729-3">)</span><span class="w"> </span><span class="nf">and</span><span class="w">
    </span><span class="p" data-group-id="7456960729-4">(</span><span class="n">E</span><span class="o">#</span><span class="ss">event</span><span class="p">.</span><span class="ss">label</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="nb">unlink</span><span class="p" data-group-id="7456960729-4">)</span><span class="w"> </span><span class="nf">and</span><span class="w">
    </span><span class="p" data-group-id="7456960729-5">(</span><span class="n">E</span><span class="o">#</span><span class="ss">event</span><span class="p">.</span><span class="ss">label</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="ss">getting_linked</span><span class="p" data-group-id="7456960729-5">)</span><span class="w"> </span><span class="ow">and</span><span class="w">
    </span><span class="nf">plain_process_info</span><span class="p" data-group-id="7456960729-6">(</span><span class="n">E</span><span class="p" data-group-id="7456960729-6">)</span><span class="p">.</span></code></pre><p>In order to simplify the startup of an <code class="inline">et_viewer</code> process with the filters
mentioned above, plus some others (that also are found in
<code class="inline">et/examples/et_demo.erl</code> src/et_collector.erl the <code class="inline">et_demo:start/0,1</code> functions
can be used:</p><pre><code class="makeup erlang" translate="no"><span class="w">
</span><span class="nf">start</span><span class="p" data-group-id="8377715985-1">(</span><span class="p" data-group-id="8377715985-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nf">start</span><span class="p" data-group-id="8377715985-2">(</span><span class="p" data-group-id="8377715985-3">[</span><span class="p" data-group-id="8377715985-3">]</span><span class="p" data-group-id="8377715985-2">)</span><span class="p">.</span><span class="w">

</span><span class="nf">start</span><span class="p" data-group-id="8377715985-4">(</span><span class="n">ExtraOptions</span><span class="p" data-group-id="8377715985-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8377715985-5">[</span><span class="p" data-group-id="8377715985-6">{</span><span class="ss">trace_global</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="8377715985-6">}</span><span class="p">,</span><span class="w">
               </span><span class="p" data-group-id="8377715985-7">{</span><span class="ss">parent_pid</span><span class="p">,</span><span class="w"> </span><span class="ss">undefined</span><span class="p" data-group-id="8377715985-7">}</span><span class="p">,</span><span class="w">
               </span><span class="p" data-group-id="8377715985-8">{</span><span class="ss">max_actors</span><span class="p">,</span><span class="w"> </span><span class="ss">infinity</span><span class="p" data-group-id="8377715985-8">}</span><span class="p">,</span><span class="w">
               </span><span class="p" data-group-id="8377715985-9">{</span><span class="ss">max_events</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p" data-group-id="8377715985-9">}</span><span class="p">,</span><span class="w">
               </span><span class="p" data-group-id="8377715985-10">{</span><span class="ss">active_filter</span><span class="p">,</span><span class="w"> </span><span class="ss">module_as_actor</span><span class="p" data-group-id="8377715985-10">}</span><span class="p" data-group-id="8377715985-5">]</span><span class="p">,</span><span class="w">
    </span><span class="nc">et_viewer</span><span class="p">:</span><span class="nf">start_link</span><span class="p" data-group-id="8377715985-11">(</span><span class="nf">filters</span><span class="p" data-group-id="8377715985-12">(</span><span class="p" data-group-id="8377715985-12">)</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">Options</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">ExtraOptions</span><span class="p" data-group-id="8377715985-11">)</span><span class="p">.</span></code></pre><p>A simple one-liner starts the tool:</p><pre><code class="text">          erl -pa ../examples -s et_demo</code></pre><p>The filters are included by the following parameters:</p><pre><code class="makeup erlang" translate="no"><span class="w">
</span><span class="nf">filters</span><span class="p" data-group-id="1212806028-1">(</span><span class="p" data-group-id="1212806028-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="1212806028-2">[</span><span class="p" data-group-id="1212806028-3">{</span><span class="ss">dict_insert</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1212806028-4">{</span><span class="ss">filter</span><span class="p">,</span><span class="w"> </span><span class="ss">module_as_actor</span><span class="p" data-group-id="1212806028-4">}</span><span class="p">,</span><span class="w">
                   </span><span class="k">fun</span><span class="w"> </span><span class="ss">module_as_actor</span><span class="p">/</span><span class="mi">1</span><span class="p" data-group-id="1212806028-3">}</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="1212806028-5">{</span><span class="ss">dict_insert</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1212806028-6">{</span><span class="ss">filter</span><span class="p">,</span><span class="w"> </span><span class="ss">plain_process_info</span><span class="p" data-group-id="1212806028-6">}</span><span class="p">,</span><span class="w">
                   </span><span class="k">fun</span><span class="w"> </span><span class="ss">plain_process_info</span><span class="p">/</span><span class="mi">1</span><span class="p" data-group-id="1212806028-5">}</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="1212806028-7">{</span><span class="ss">dict_insert</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1212806028-8">{</span><span class="ss">filter</span><span class="p">,</span><span class="w"> </span><span class="ss">plain_process_info_nolink</span><span class="p" data-group-id="1212806028-8">}</span><span class="p">,</span><span class="w">
                   </span><span class="k">fun</span><span class="w"> </span><span class="ss">plain_process_info_nolink</span><span class="p">/</span><span class="mi">1</span><span class="p" data-group-id="1212806028-7">}</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="1212806028-9">{</span><span class="ss">dict_insert</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1212806028-10">{</span><span class="ss">filter</span><span class="p">,</span><span class="w"> </span><span class="ss">named_process_info</span><span class="p" data-group-id="1212806028-10">}</span><span class="p">,</span><span class="w">
                   </span><span class="k">fun</span><span class="w"> </span><span class="ss">named_process_info</span><span class="p">/</span><span class="mi">1</span><span class="p" data-group-id="1212806028-9">}</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="1212806028-11">{</span><span class="ss">dict_insert</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1212806028-12">{</span><span class="ss">filter</span><span class="p">,</span><span class="w"> </span><span class="ss">named_process_info_nolink</span><span class="p" data-group-id="1212806028-12">}</span><span class="p">,</span><span class="w">
                   </span><span class="k">fun</span><span class="w"> </span><span class="ss">named_process_info_nolink</span><span class="p">/</span><span class="mi">1</span><span class="p" data-group-id="1212806028-11">}</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="1212806028-13">{</span><span class="ss">dict_insert</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1212806028-14">{</span><span class="ss">filter</span><span class="p">,</span><span class="w"> </span><span class="ss">node_process_info</span><span class="p" data-group-id="1212806028-14">}</span><span class="p">,</span><span class="w">
                   </span><span class="k">fun</span><span class="w"> </span><span class="ss">node_process_info</span><span class="p">/</span><span class="mi">1</span><span class="p" data-group-id="1212806028-13">}</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="1212806028-15">{</span><span class="ss">dict_insert</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1212806028-16">{</span><span class="ss">filter</span><span class="p">,</span><span class="w"> </span><span class="ss">node_process_info_nolink</span><span class="p" data-group-id="1212806028-16">}</span><span class="p">,</span><span class="w">
                   </span><span class="k">fun</span><span class="w"> </span><span class="ss">node_process_info_nolink</span><span class="p">/</span><span class="mi">1</span><span class="p" data-group-id="1212806028-15">}</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="1212806028-17">{</span><span class="ss">dict_insert</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1212806028-18">{</span><span class="ss">filter</span><span class="p">,</span><span class="w"> </span><span class="ss">application_as_actor</span><span class="p" data-group-id="1212806028-18">}</span><span class="p">,</span><span class="w">
                   </span><span class="k">fun</span><span class="w"> </span><span class="ss">application_as_actor</span><span class="p">/</span><span class="mi">1</span><span class="p" data-group-id="1212806028-17">}</span><span class="w">
    </span><span class="p" data-group-id="1212806028-2">]</span><span class="p">.</span></code></pre><h2 id="erlang-trace-of-a-real-mnesia-transaction" class="section-heading">
  <a href="#erlang-trace-of-a-real-mnesia-transaction" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Erlang trace of a real Mnesia transaction</span>
</h2>
<p>The following piece of code <code class="inline">et_demo:trace_mnesia/0</code> activates call tracing of
both local and external function calls for all modules in the <code class="inline">Mnesia</code>
application. The call traces are configured cover all processes (both existing
and those that are spawned in the future) and include timestamps for trace data.
It do also activate tracing of process related events for <code class="inline">Mnesia</code>'s static
processes plus the calling process (that is your shell). Please, observe that
the <a href="../../../../lib/../erts/doc/html/erlang.html#whereis/1"><code class="inline">whereis/1</code></a> call in the following code requires that both the traced
<code class="inline">Mnesia</code> application and the <code class="inline">et_viewer</code> is running on the same node:</p><pre><code class="makeup erlang" translate="no"><span class="w">
</span><span class="nf">trace_mnesia</span><span class="p" data-group-id="6896361209-1">(</span><span class="p" data-group-id="6896361209-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Modules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">mnesia</span><span class="p">:</span><span class="nf">ms</span><span class="p" data-group-id="6896361209-2">(</span><span class="p" data-group-id="6896361209-2">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6896361209-3">[</span><span class="p" data-group-id="6896361209-4">{</span><span class="ss">message</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6896361209-5">{</span><span class="ss">caller</span><span class="p" data-group-id="6896361209-5">}</span><span class="p" data-group-id="6896361209-4">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6896361209-6">{</span><span class="ss">return_trace</span><span class="p" data-group-id="6896361209-6">}</span><span class="p" data-group-id="6896361209-3">]</span><span class="p">,</span><span class="w">
    </span><span class="n">Flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6896361209-7">[</span><span class="nb">send</span><span class="p">,</span><span class="w"> </span><span class="ss">&#39;receive&#39;</span><span class="p">,</span><span class="w"> </span><span class="ss">procs</span><span class="p">,</span><span class="w"> </span><span class="ss">timestamp</span><span class="p" data-group-id="6896361209-7">]</span><span class="p">,</span><span class="w">
    </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">p</span><span class="p" data-group-id="6896361209-8">(</span><span class="ss">all</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6896361209-9">[</span><span class="ss">call</span><span class="p">,</span><span class="w"> </span><span class="ss">timestamp</span><span class="p" data-group-id="6896361209-9">]</span><span class="p" data-group-id="6896361209-8">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6896361209-10">[</span><span class="nc">dbg</span><span class="p">:</span><span class="nf">tpl</span><span class="p" data-group-id="6896361209-11">(</span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6896361209-12">[</span><span class="p" data-group-id="6896361209-13">{</span><span class="ss">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6896361209-14">[</span><span class="p" data-group-id="6896361209-14">]</span><span class="p">,</span><span class="w"> </span><span class="n">Spec</span><span class="p" data-group-id="6896361209-13">}</span><span class="p" data-group-id="6896361209-12">]</span><span class="p" data-group-id="6896361209-11">)</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Modules</span><span class="p" data-group-id="6896361209-10">]</span><span class="p">,</span><span class="w">
    </span><span class="n">LocallyRunningServers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6896361209-15">[</span><span class="n">M</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Modules</span><span class="p">,</span><span class="w"> </span><span class="nf">whereis</span><span class="p" data-group-id="6896361209-16">(</span><span class="n">M</span><span class="p" data-group-id="6896361209-16">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="ss">undefined</span><span class="p" data-group-id="6896361209-15">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6896361209-17">[</span><span class="nc">dbg</span><span class="p">:</span><span class="nf">p</span><span class="p" data-group-id="6896361209-18">(</span><span class="nf">whereis</span><span class="p" data-group-id="6896361209-19">(</span><span class="n">RS</span><span class="p" data-group-id="6896361209-19">)</span><span class="p">,</span><span class="w"> </span><span class="n">Flags</span><span class="p" data-group-id="6896361209-18">)</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">RS</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">LocallyRunningServers</span><span class="p" data-group-id="6896361209-17">]</span><span class="p">,</span><span class="w">
    </span><span class="nc">dbg</span><span class="p">:</span><span class="nf">p</span><span class="p" data-group-id="6896361209-20">(</span><span class="nf">self</span><span class="p" data-group-id="6896361209-21">(</span><span class="p" data-group-id="6896361209-21">)</span><span class="p">,</span><span class="w"> </span><span class="n">Flags</span><span class="p" data-group-id="6896361209-20">)</span><span class="p">,</span><span class="w">
    </span><span class="n">LocallyRunningServers</span><span class="p">.</span></code></pre><p>The <code class="inline">et_demo:live_trans/0</code> function starts the global <code class="inline">Collector</code>, starts a
<code class="inline">Viewer</code>, starts <code class="inline">Mnesia</code>, creates a local table, activates tracing (as
described above) and registers the shell process is as 'my_shell' for clarity.
Finally a simple <code class="inline">Mnesia</code> transaction that writes a single record is run:</p><pre><code class="makeup erlang" translate="no"><span class="w">
</span><span class="nf">live_trans</span><span class="p" data-group-id="7003022097-1">(</span><span class="p" data-group-id="7003022097-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nf">live_trans</span><span class="p" data-group-id="7003022097-2">(</span><span class="p" data-group-id="7003022097-3">[</span><span class="p" data-group-id="7003022097-3">]</span><span class="p" data-group-id="7003022097-2">)</span><span class="p">.</span><span class="w">

</span><span class="nf">live_trans</span><span class="p" data-group-id="7003022097-4">(</span><span class="n">ExtraOptions</span><span class="p" data-group-id="7003022097-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">Options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7003022097-5">[</span><span class="p" data-group-id="7003022097-6">{</span><span class="ss">title</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Mnesia tracer&quot;</span><span class="p" data-group-id="7003022097-6">}</span><span class="p">,</span><span class="w">
</span><span class="err">	</span><span class="w">       </span><span class="p" data-group-id="7003022097-7">{</span><span class="ss">hide_actions</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="7003022097-7">}</span><span class="p">,</span><span class="w">
</span><span class="err">	</span><span class="w">       </span><span class="p" data-group-id="7003022097-8">{</span><span class="ss">active_filter</span><span class="p">,</span><span class="w"> </span><span class="ss">named_process_info_nolink</span><span class="p" data-group-id="7003022097-8">}</span><span class="p" data-group-id="7003022097-5">]</span><span class="p">,</span><span class="w">
    </span><span class="nc">et_demo</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="7003022097-9">(</span><span class="n">Options</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">ExtraOptions</span><span class="p" data-group-id="7003022097-9">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">mnesia</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="7003022097-10">(</span><span class="p" data-group-id="7003022097-10">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">mnesia</span><span class="p">:</span><span class="nf">create_table</span><span class="p" data-group-id="7003022097-11">(</span><span class="ss">my_tab</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7003022097-12">[</span><span class="p" data-group-id="7003022097-13">{</span><span class="ss">ram_copies</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7003022097-14">[</span><span class="nf">node</span><span class="p" data-group-id="7003022097-15">(</span><span class="p" data-group-id="7003022097-15">)</span><span class="p" data-group-id="7003022097-14">]</span><span class="p" data-group-id="7003022097-13">}</span><span class="p" data-group-id="7003022097-12">]</span><span class="p" data-group-id="7003022097-11">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">et_demo</span><span class="p">:</span><span class="nf">trace_mnesia</span><span class="p" data-group-id="7003022097-16">(</span><span class="p" data-group-id="7003022097-16">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="7003022097-17">(</span><span class="ss">my_shell</span><span class="p">,</span><span class="w"> </span><span class="nf">self</span><span class="p" data-group-id="7003022097-18">(</span><span class="p" data-group-id="7003022097-18">)</span><span class="p" data-group-id="7003022097-17">)</span><span class="p">,</span><span class="w">

    </span><span class="nc">mnesia</span><span class="p">:</span><span class="nf">transaction</span><span class="p" data-group-id="7003022097-19">(</span><span class="nf">fun</span><span class="p" data-group-id="7003022097-20">(</span><span class="p" data-group-id="7003022097-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">mnesia</span><span class="p">:</span><span class="nf">write</span><span class="p" data-group-id="7003022097-21">(</span><span class="p" data-group-id="7003022097-22">{</span><span class="ss">my_tab</span><span class="p">,</span><span class="w"> </span><span class="ss">key</span><span class="p">,</span><span class="w"> </span><span class="ss">val</span><span class="p" data-group-id="7003022097-22">}</span><span class="p" data-group-id="7003022097-21">)</span><span class="w"> </span><span class="k">end</span><span class="p" data-group-id="7003022097-19">)</span><span class="p">.</span></code></pre><p>Now we run the <code class="inline">et_demo:live_trans/0</code> function:</p><pre><code class="text">erl -pa ../examples
Erlang R13B03 (erts-5.7.4) [64-bit] [smp:4:4] [rq:4]
                           [async-threads:0] [kernel-poll:false]

Eshell V5.7.4  (abort with ^G)
1&gt; et_demo:live_trans().
{atomic,ok}</code></pre><p>Please, explore the different filters in order to see how the traced transaction
can be seen from different point of views:</p><p><img src="assets/live_trans.png" alt="A real Mnesia transaction which writes one record" title="A real Mnesia transaction which writes one record"/></p><h2 id="erlang-trace-of-megaco-startup" class="section-heading">
  <a href="#erlang-trace-of-megaco-startup" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Erlang trace of Megaco startup</span>
</h2>
<p>The <code class="inline">Event Tracer (ET)</code> tool was initially written in order to demonstrate how
messages where sent over the <code class="inline">Megaco</code> protocol. This were back in the old days
before the standard bodies of <code class="inline">IETF</code> and <code class="inline">ITU</code> had approved <code class="inline">Megaco</code> (also
called <code class="inline">H.248</code>) as an international standard.</p><p>In the <code class="inline">Megaco</code> application of Erlang/OTP, the code is carefully instrumented
with calls to <a href="et.html#trace_me/5"><code class="inline">et:trace_me/5</code></a>. For each call a detail level is given in order to
enable dynamic control of the trace level in a simple manner.</p><p>The <code class="inline">megaco_filter</code> module implements a customized filter for <code class="inline">Megaco</code> messages.
It does also make use of <code class="inline">trace_global</code> combined with usage of the
<code class="inline">trace_pattern</code>:</p><pre><code class="text">-module(megaco_filter).
-export([start/0]).

start() -&gt;
    Options =
        [{event_order, event_ts},
         {scale, 3},
         {max_actors, infinity},
         {trace_pattern, {megaco, max}},
         {trace_global, true},
         {dict_insert, {filter, megaco_filter}, fun filter/1},
         {active_filter, megaco_filter},
         {title, &quot;Megaco tracer - Erlang/OTP&quot;}],
    et_viewer:start(Options).</code></pre><p>First we start an Erlang node with a global <code class="inline">Collector</code> and its <code class="inline">Viewer</code>.</p><pre><code class="text">erl -sname observer
Erlang R13B03 (erts-5.7.4) [64-bit] [smp:4:4] [rq:4] [async-threads:0] [kernel-poll:false]

Eshell V5.7.4  (abort with ^G)
(observer@falco)1&gt; megaco_filter:start().
{ok,&lt;0.48.0&gt;}</code></pre><p>Secondly we start another Erlang node which we connect the observer node, before
we start the application that we want to trace. In this case we start a Media
Gateway Controller that listens for both TCP and UDP on the text and binary
ports for Megaco:</p><pre><code class="text">erl -sname mgc -pa ../../megaco/examples/simple
Erlang R13B03 (erts-5.7.4) [64-bit] [smp:4:4] [rq:4] [async-threads:0] [kernel-poll:false]

Eshell V5.7.4  (abort with ^G)
(mgc@falco)1&gt; net:ping(observer@falco).
pong
(mgc@falco)2&gt; megaco:start().
ok
(mgc@falco)3&gt; megaco_simple_mgc:start().
{ok,[{ok,2944,
         {megaco_receive_handle,{deviceName,&quot;controller&quot;},
                                megaco_pretty_text_encoder,[],megaco_tcp,dynamic}},
     {ok,2944,
         {megaco_receive_handle,{deviceName,&quot;controller&quot;},
                                megaco_pretty_text_encoder,[],megaco_udp,dynamic}},
     {ok,2945,
         {megaco_receive_handle,{deviceName,&quot;controller&quot;},
                                megaco_binary_encoder,[],megaco_tcp,dynamic}},
     {ok,2945,
         {megaco_receive_handle,{deviceName,&quot;controller&quot;},
                                megaco_binary_encoder,[],megaco_udp,dynamic}}]}</code></pre><p>And finally we start an Erlang node for the Media Gateways and connect to the
observer node. Each Media Gateway connects to the controller and sends an
initial Service Change message. The controller accepts the gateways and sends a
reply to each one using the same transport mechanism and message encoding
according to the preference of each gateway. That is all combinations of TCP/IP
transport, UDP/IP transport, text encoding and ASN.1 BER encoding:</p><pre><code class="text">Erlang R13B03 (erts-5.7.4) [64-bit] [smp:4:4] [rq:4] [async-threads:0] [kernel-poll:false]

Eshell V5.7.4  (abort with ^G)
(mg@falco)1&gt; net:ping(observer@falco).
pong
(mg@falco)2&gt; megaco_simple_mg:start().
[{{deviceName,&quot;gateway_tt&quot;},
  {error,{start_user,megaco_not_started}}},
 {{deviceName,&quot;gateway_tb&quot;},
  {error,{start_user,megaco_not_started}}},
 {{deviceName,&quot;gateway_ut&quot;},
  {error,{start_user,megaco_not_started}}},
 {{deviceName,&quot;gateway_ub&quot;},
  {error,{start_user,megaco_not_started}}}]
(mg@falco)3&gt; megaco:start().
ok
(mg@falco)4&gt; megaco_simple_mg:start().
[{{deviceName,&quot;gateway_tt&quot;},
  {1,
   {ok,[{'ActionReply',0,asn1_NOVALUE,asn1_NOVALUE,
            [{serviceChangeReply,
                 {'ServiceChangeReply',
                     [{megaco_term_id,false,[&quot;root&quot;]}],
                     {serviceChangeResParms,
                         {'ServiceChangeResParm',
                             {deviceName,&quot;controller&quot;},
                             asn1_NOVALUE,asn1_NOVALUE,asn1_NOVALUE,
                             asn1_NOVALUE}}}}]}]}}},
 {{deviceName,&quot;gateway_tb&quot;},
  {1,
   {ok,[{'ActionReply',0,asn1_NOVALUE,asn1_NOVALUE,
            [{serviceChangeReply,
                 {'ServiceChangeReply',
                     [{megaco_term_id,false,[&quot;root&quot;]}],
                     {serviceChangeResParms,
                         {'ServiceChangeResParm',
                             {deviceName,&quot;controller&quot;},
                             asn1_NOVALUE,asn1_NOVALUE,asn1_NOVALUE,
                             asn1_NOVALUE}}}}]}]}}},
 {{deviceName,&quot;gateway_ut&quot;},
  {1,
   {ok,[{'ActionReply',0,asn1_NOVALUE,asn1_NOVALUE,
            [{serviceChangeReply,
                 {'ServiceChangeReply',
                     [{megaco_term_id,false,[&quot;root&quot;]}],
                     {serviceChangeResParms,
                         {'ServiceChangeResParm',
                             {deviceName,&quot;controller&quot;},
                             asn1_NOVALUE,asn1_NOVALUE,asn1_NOVALUE,
                             asn1_NOVALUE}}}}]}]}}},
 {{deviceName,&quot;gateway_ub&quot;},
  {1,
   {ok,[{'ActionReply',0,asn1_NOVALUE,asn1_NOVALUE,
            [{serviceChangeReply,
                 {'ServiceChangeReply',
                     [{megaco_term_id,false,[&quot;root&quot;]}],
                     {serviceChangeResParms,
                         {'ServiceChangeResParm',
                             {deviceName,&quot;controller&quot;},
                             asn1_NOVALUE,asn1_NOVALUE,
                             asn1_NOVALUE,...}}}}]}]}}}]</code></pre><p>The <code class="inline">Megaco</code> adopted viewer looks like this, when we have clicked on the
<em>[gateway_tt]</em> actor name in order to only display the events regarding that
actor:</p><p><img src="assets/megaco_tracer.png" alt="The viewer adopted for Megaco" title="The viewer adopted for Megaco"/></p><p>A pretty printed <code class="inline">Megaco</code> message looks like this:</p><p><img src="assets/megaco_filter.png" alt="A textual Megaco message" title="A textual Megaco message"/></p><p>And the corresponding internal form for the same <code class="inline">Megaco</code> message looks like
this:</p><p><img src="assets/megaco_collector.png" alt="The internal form of a Megaco message" title="The internal form of a Megaco message"/></p>
<div class="bottom-actions">
  <div class="bottom-actions-item">

      <a href="et_desc.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Description
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

  </div>
</div>
      <footer class="footer">
        <p>

          <span class="line">
            <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
              Search HexDocs
            </button>

          </span>
        </p>

        <p class="built-using">
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.30.9) for the

            <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

        </p>
      </footer>
    </div>
  </div>
</main>
</div>


  </body>
</html>

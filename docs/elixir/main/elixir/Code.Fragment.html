<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.29.4">
    <meta name="project" content="Elixir v1.15.0-dev">

    <title>Code.Fragment â€” Elixir v1.15.0-dev</title>
    <link rel="stylesheet" href="dist/html-elixir-R7PT35Y2.css" />


      <link rel="canonical" href="https://hexdocs.pm/elixir/main/Code.Fragment.html" />

    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-OHVEJKU6.js"></script>
    <script src="dist/sidebar_items-E44CB883.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/html-ZKIIOKLS.js"></script>


  </head>
  <body data-type="modules" class="page-module">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">

<button class="sidebar-button sidebar-toggle" aria-label="toggle sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<section class="sidebar">
  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <i class="ri-search-2-line" aria-hidden="true" title="Submit search"></i>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <i class="ri-close-line ri-lg" aria-hidden="true" title="Cancel search"></i>
    </button>
    <label class="search-label">
      <p class="sr-only">Search</p>
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">

    <div class="sidebar-projectDetails">
      <a href="https://elixir-lang.org/docs.html" class="sidebar-projectName" translate="no">
Elixir
      </a>
      <div class="sidebar-projectVersion" translate="no">
        v1.15.0-dev
      </div>
    </div>
    <ul class="sidebar-listNav">
      <li><a id="extras-list-link" href="#full-list">Pages</a></li>

        <li><a id="modules-list-link" href="#full-list">Modules</a></li>


    </ul>
  </div>

  <div class="gradient"></div>
  <ul id="full-list"></ul>
</section>

<section class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1>
<button class="icon-action display-settings">
  <i class="ri-settings-3-line"></i>
  <span class="sr-only">Settings</span>
</button>


    <a href="https://github.com/elixir-lang/elixir/blob/6407215fb97ca6699776db771accc9523f4e4a1f/lib/elixir/lib/code/fragment.ex#L1" title="View Source" class="icon-action" rel="help">
      <i class="ri-code-s-slash-line" aria-hidden="true"></i>
      <span class="sr-only">View Source</span>
    </a>

  <span translate="no">Code.Fragment</span> 
  <small class="app-vsn" translate="no">(Elixir v1.15.0-dev)</small>

</h1>


  <section id="moduledoc">
<p>This module provides conveniences for analyzing fragments of
textual code and extract available information whenever possible.</p><p>Most of the functions in this module provide a best-effort
and may not be accurate under all circumstances. Read each
documentation for more information.</p><p>This module should be considered experimental.</p>
  </section>


  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
      Summary
    </h1>
<div class="summary-types summary">
  <h2>
    <a href="#types">Types</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:position/0" translate="no">position()</a>

      </div>

    </div>

</div>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#container_cursor_to_quoted/2" translate="no">container_cursor_to_quoted(fragment, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Receives a string and returns a quoted expression
with a cursor at the nearest argument position.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#cursor_context/2" translate="no">cursor_context(fragment, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Receives a string and returns the cursor context.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#surround_context/3" translate="no">surround_context(fragment, position, options \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Receives a string and returns the surround context.</p></div>

    </div>

</div>

  </section>


  <section id="types" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#types">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
Types
    </h1>
    <div class="types-list">
<section class="detail" id="t:position/0">

  <div class="detail-header">
    <a href="#t:position/0" class="detail-link" title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">position()</h1>

      <a href="https://github.com/elixir-lang/elixir/blob/6407215fb97ca6699776db771accc9523f4e4a1f/lib/elixir/lib/code/fragment.ex#L13" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> position() :: {line :: <a href="typespecs.html#basic-types">pos_integer</a>(), column :: <a href="typespecs.html#basic-types">pos_integer</a>()}</pre>

      </div>


  </section>
</section>

    </div>
  </section>

  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
Functions
    </h1>
    <div class="functions-list">
<section class="detail" id="container_cursor_to_quoted/2">

    <span id="container_cursor_to_quoted/1"></span>

  <div class="detail-header">
    <a href="#container_cursor_to_quoted/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">container_cursor_to_quoted(fragment, opts \\ [])</h1>

      <a href="https://github.com/elixir-lang/elixir/blob/6407215fb97ca6699776db771accc9523f4e4a1f/lib/elixir/lib/code/fragment.ex#L1053" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since 1.13.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> container_cursor_to_quoted(
  <a href="List.Chars.html#t:t/0">List.Chars.t</a>(),
  <a href="typespecs.html#built-in-types">keyword</a>()
) ::
  {:ok, <a href="Macro.html#t:t/0">Macro.t</a>()}
  | {:error, {location :: <a href="typespecs.html#built-in-types">keyword</a>(), <a href="typespecs.html#built-in-types">binary</a>() | {<a href="typespecs.html#built-in-types">binary</a>(), <a href="typespecs.html#built-in-types">binary</a>()}, <a href="typespecs.html#built-in-types">binary</a>()}}</pre>

      </div>

<p>Receives a string and returns a quoted expression
with a cursor at the nearest argument position.</p><p>This function receives a string with an Elixir code fragment,
representing a cursor position, and converts such string to
AST with the inclusion of special <code class="inline">__cursor__()</code> node based
on the position of the cursor with a container.</p><p>A container is any Elixir expression starting with <code class="inline">(</code>,
<code class="inline">{</code>, and <code class="inline">[</code>. This includes function calls, tuples, lists,
maps, and so on. For example, take this code, which would
be given as input:</p><pre><code class="makeup elixir" translate="no"><span class="n">max</span><span class="p" data-group-id="0117214767-1">(</span><span class="n">some_value</span><span class="p">,</span></code></pre><p>This function will return the AST equivalent to:</p><pre><code class="makeup elixir" translate="no"><span class="n">max</span><span class="p" data-group-id="8256143583-1">(</span><span class="n">some_value</span><span class="p">,</span><span class="w"> </span><span class="c">__cursor__</span><span class="p" data-group-id="8256143583-2">(</span><span class="p" data-group-id="8256143583-2">)</span><span class="p" data-group-id="8256143583-1">)</span></code></pre><p>In other words, this function is capable of closing any open
brackets and insert the cursor position. Any content at the
cursor position that is after a comma or an opening bracket
is discarded. For example, if this is given as input:</p><pre><code class="makeup elixir" translate="no"><span class="n">max</span><span class="p" data-group-id="7204058925-1">(</span><span class="n">some_value</span><span class="p">,</span><span class="w"> </span><span class="n">another_val</span></code></pre><p>It will return the same AST:</p><pre><code class="makeup elixir" translate="no"><span class="n">max</span><span class="p" data-group-id="4011850261-1">(</span><span class="n">some_value</span><span class="p">,</span><span class="w"> </span><span class="c">__cursor__</span><span class="p" data-group-id="4011850261-2">(</span><span class="p" data-group-id="4011850261-2">)</span><span class="p" data-group-id="4011850261-1">)</span></code></pre><p>Similarly, if only this is given:</p><pre><code class="makeup elixir" translate="no"><span class="n">max</span><span class="p" data-group-id="3924148448-1">(</span><span class="n">some_va</span></code></pre><p>Then it returns:</p><pre><code class="makeup elixir" translate="no"><span class="n">max</span><span class="p" data-group-id="7607059920-1">(</span><span class="c">__cursor__</span><span class="p" data-group-id="7607059920-2">(</span><span class="p" data-group-id="7607059920-2">)</span><span class="p" data-group-id="7607059920-1">)</span></code></pre><p>Calls without parenthesis are also supported, as we assume the
brackets are implicit.</p><p>Operators and anonymous functions are not containers, and therefore
will be discarded. The following will all return the same AST:</p><pre><code class="makeup elixir" translate="no"><span class="n">max</span><span class="p" data-group-id="7631918427-1">(</span><span class="n">some_value</span><span class="p">,</span><span class="w">
</span><span class="n">max</span><span class="p" data-group-id="7631918427-2">(</span><span class="n">some_value</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="7631918427-3">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k" data-group-id="7631918427-3">end</span><span class="w">
</span><span class="n">max</span><span class="p" data-group-id="7631918427-4">(</span><span class="n">some_value</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">another_val</span><span class="w">
</span><span class="n">max</span><span class="p" data-group-id="7631918427-5">(</span><span class="n">some_value</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">some_fun</span><span class="p" data-group-id="7631918427-6">(</span><span class="p" data-group-id="7631918427-6">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">another_fun</span></code></pre><p>On the other hand, tuples, lists, maps, and binaries all retain the
cursor position:</p><pre><code class="makeup elixir" translate="no"><span class="n">max</span><span class="p" data-group-id="3663971618-1">(</span><span class="n">some_value</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3663971618-2">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span></code></pre><p>Returns the following AST:</p><pre><code class="makeup elixir" translate="no"><span class="n">max</span><span class="p" data-group-id="3856942886-1">(</span><span class="n">some_value</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3856942886-2">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="c">__cursor__</span><span class="p" data-group-id="3856942886-3">(</span><span class="p" data-group-id="3856942886-3">)</span><span class="p" data-group-id="3856942886-2">]</span><span class="p" data-group-id="3856942886-1">)</span></code></pre><p>Keyword lists (and do-end blocks) are also retained. The following:</p><pre><code class="makeup elixir" translate="no"><span class="k">if</span><span class="p" data-group-id="6809810568-1">(</span><span class="n">some_value</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w">
</span><span class="k">if</span><span class="p" data-group-id="6809810568-2">(</span><span class="n">some_value</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="ss">:token</span><span class="w">
</span><span class="k">if</span><span class="p" data-group-id="6809810568-3">(</span><span class="n">some_value</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">val</span></code></pre><p>all return:</p><pre><code class="makeup elixir" translate="no"><span class="k">if</span><span class="p" data-group-id="7862148338-1">(</span><span class="n">some_value</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="c">__cursor__</span><span class="p" data-group-id="7862148338-2">(</span><span class="p" data-group-id="7862148338-2">)</span><span class="p" data-group-id="7862148338-1">)</span></code></pre><p>The AST returned by this function is not safe to evaluate but
it can be analyzed and expanded.</p><h2 id="container_cursor_to_quoted/2-examples" class="section-heading">
  <a href="#container_cursor_to_quoted/2-examples">
    <i class="ri-link-m" aria-hidden="true"></i>
    Examples
  </a>
</h2>
<p>Function call:</p><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="nc">Code.Fragment</span><span class="o">.</span><span class="n">container_cursor_to_quoted</span><span class="p" data-group-id="2777744242-1">(</span><span class="s">&quot;max(some_value, &quot;</span><span class="p" data-group-id="2777744242-1">)</span><span class="w">
</span><span class="p" data-group-id="2777744242-2">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2777744242-3">{</span><span class="ss">:max</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2777744242-4">[</span><span class="ss">line</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="2777744242-4">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2777744242-5">[</span><span class="p" data-group-id="2777744242-6">{</span><span class="ss">:some_value</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2777744242-7">[</span><span class="ss">line</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="2777744242-7">]</span><span class="p">,</span><span class="w"> </span><span class="no">nil</span><span class="p" data-group-id="2777744242-6">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2777744242-8">{</span><span class="ss">:__cursor__</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2777744242-9">[</span><span class="ss">line</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="2777744242-9">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2777744242-10">[</span><span class="p" data-group-id="2777744242-10">]</span><span class="p" data-group-id="2777744242-8">}</span><span class="p" data-group-id="2777744242-5">]</span><span class="p" data-group-id="2777744242-3">}</span><span class="p" data-group-id="2777744242-2">}</span></code></pre><p>Containers (for example, a list):</p><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="nc">Code.Fragment</span><span class="o">.</span><span class="n">container_cursor_to_quoted</span><span class="p" data-group-id="2885633612-1">(</span><span class="s">&quot;[some, value&quot;</span><span class="p" data-group-id="2885633612-1">)</span><span class="w">
</span><span class="p" data-group-id="2885633612-2">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2885633612-3">[</span><span class="p" data-group-id="2885633612-4">{</span><span class="ss">:some</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2885633612-5">[</span><span class="ss">line</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="2885633612-5">]</span><span class="p">,</span><span class="w"> </span><span class="no">nil</span><span class="p" data-group-id="2885633612-4">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2885633612-6">{</span><span class="ss">:__cursor__</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2885633612-7">[</span><span class="ss">line</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="2885633612-7">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2885633612-8">[</span><span class="p" data-group-id="2885633612-8">]</span><span class="p" data-group-id="2885633612-6">}</span><span class="p" data-group-id="2885633612-3">]</span><span class="p" data-group-id="2885633612-2">}</span></code></pre><p>For binaries, the <code class="inline">::</code> is exclusively kept as an operator:</p><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="nc">Code.Fragment</span><span class="o">.</span><span class="n">container_cursor_to_quoted</span><span class="p" data-group-id="8771387888-1">(</span><span class="s">&quot;&lt;&lt;some::integer&quot;</span><span class="p" data-group-id="8771387888-1">)</span><span class="w">
</span><span class="p" data-group-id="8771387888-2">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8771387888-3">{</span><span class="ss">:&lt;&lt;&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8771387888-4">[</span><span class="ss">line</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="8771387888-4">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8771387888-5">[</span><span class="p" data-group-id="8771387888-6">{</span><span class="ss">:&quot;::&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8771387888-7">[</span><span class="ss">line</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="8771387888-7">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8771387888-8">[</span><span class="p" data-group-id="8771387888-9">{</span><span class="ss">:some</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8771387888-10">[</span><span class="ss">line</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="8771387888-10">]</span><span class="p">,</span><span class="w"> </span><span class="no">nil</span><span class="p" data-group-id="8771387888-9">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8771387888-11">{</span><span class="ss">:__cursor__</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8771387888-12">[</span><span class="ss">line</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="8771387888-12">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8771387888-13">[</span><span class="p" data-group-id="8771387888-13">]</span><span class="p" data-group-id="8771387888-11">}</span><span class="p" data-group-id="8771387888-8">]</span><span class="p" data-group-id="8771387888-6">}</span><span class="p" data-group-id="8771387888-5">]</span><span class="p" data-group-id="8771387888-3">}</span><span class="p" data-group-id="8771387888-2">}</span></code></pre><h2 id="container_cursor_to_quoted/2-options" class="section-heading">
  <a href="#container_cursor_to_quoted/2-options">
    <i class="ri-link-m" aria-hidden="true"></i>
    Options
  </a>
</h2>
<ul><li><p><code class="inline">:file</code> - the filename to be reported in case of parsing errors.
Defaults to <code class="inline">&quot;nofile&quot;</code>.</p></li><li><p><code class="inline">:line</code> - the starting line of the string being parsed.
Defaults to 1.</p></li><li><p><code class="inline">:column</code> - the starting column of the string being parsed.
Defaults to 1.</p></li><li><p><code class="inline">:columns</code> - when <code class="inline">true</code>, attach a <code class="inline">:column</code> key to the quoted
metadata. Defaults to <code class="inline">false</code>.</p></li><li><p><code class="inline">:token_metadata</code> - when <code class="inline">true</code>, includes token-related
metadata in the expression AST, such as metadata for <code class="inline">do</code> and <code class="inline">end</code>
tokens, for closing tokens, end of expressions, as well as delimiters
for sigils. See <a href="Macro.html#t:metadata/0"><code class="inline">Macro.metadata/0</code></a>. Defaults to <code class="inline">false</code>.</p></li><li><p><code class="inline">:literal_encoder</code> - a function to encode literals in the AST.
See the documentation for <a href="Code.html#string_to_quoted/2"><code class="inline">Code.string_to_quoted/2</code></a> for more information.</p></li></ul>
  </section>
</section>
<section class="detail" id="cursor_context/2">

    <span id="cursor_context/1"></span>

  <div class="detail-header">
    <a href="#cursor_context/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">cursor_context(fragment, opts \\ [])</h1>

      <a href="https://github.com/elixir-lang/elixir/blob/6407215fb97ca6699776db771accc9523f4e4a1f/lib/elixir/lib/code/fragment.ex#L155" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since 1.13.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> cursor_context(
  <a href="List.Chars.html#t:t/0">List.Chars.t</a>(),
  <a href="typespecs.html#built-in-types">keyword</a>()
) ::
  {:alias, <a href="typespecs.html#built-in-types">charlist</a>()}
  | {:alias, inside_alias, <a href="typespecs.html#built-in-types">charlist</a>()}
  | {:dot, inside_dot, <a href="typespecs.html#built-in-types">charlist</a>()}
  | {:dot_arity, inside_dot, <a href="typespecs.html#built-in-types">charlist</a>()}
  | {:dot_call, inside_dot, <a href="typespecs.html#built-in-types">charlist</a>()}
  | :expr
  | {:local_or_var, <a href="typespecs.html#built-in-types">charlist</a>()}
  | {:local_arity, <a href="typespecs.html#built-in-types">charlist</a>()}
  | {:local_call, <a href="typespecs.html#built-in-types">charlist</a>()}
  | {:module_attribute, <a href="typespecs.html#built-in-types">charlist</a>()}
  | {:operator, <a href="typespecs.html#built-in-types">charlist</a>()}
  | {:operator_arity, <a href="typespecs.html#built-in-types">charlist</a>()}
  | {:operator_call, <a href="typespecs.html#built-in-types">charlist</a>()}
  | :none
  | {:sigil, <a href="typespecs.html#built-in-types">charlist</a>()}
  | {:struct, inside_struct}
  | {:unquoted_atom, <a href="typespecs.html#built-in-types">charlist</a>()}
when inside_dot:
       {:alias, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:alias, inside_alias, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:dot, inside_dot, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:module_attribute, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:unquoted_atom, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:var, <a href="typespecs.html#built-in-types">charlist</a>()}
       | :expr,
     inside_alias: {:local_or_var, <a href="typespecs.html#built-in-types">charlist</a>()} | {:module_attribute, <a href="typespecs.html#built-in-types">charlist</a>()},
     inside_struct:
       <a href="typespecs.html#built-in-types">charlist</a>()
       | {:alias, inside_alias, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:local_or_var, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:module_attribute, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:dot, inside_dot, <a href="typespecs.html#built-in-types">charlist</a>()}</pre>

      </div>

<p>Receives a string and returns the cursor context.</p><p>This function receives a string with an Elixir code fragment,
representing a cursor position, and based on the string, it
provides contextual information about said position. The
return of this function can then be used to provide tips,
suggestions, and autocompletion functionality.</p><p>This function provides a best-effort detection and may not be
accurate under all circumstances. See the &quot;Limitations&quot;
section below.</p><p>Consider adding a catch-all clause when handling the return
type of this function as new cursor information may be added
in future releases.</p><h2 id="cursor_context/2-examples" class="section-heading">
  <a href="#cursor_context/2-examples">
    <i class="ri-link-m" aria-hidden="true"></i>
    Examples
  </a>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="nc">Code.Fragment</span><span class="o">.</span><span class="n">cursor_context</span><span class="p" data-group-id="3322648802-1">(</span><span class="s">&quot;&quot;</span><span class="p" data-group-id="3322648802-1">)</span><span class="w">
</span><span class="ss">:expr</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="nc">Code.Fragment</span><span class="o">.</span><span class="n">cursor_context</span><span class="p" data-group-id="3322648802-2">(</span><span class="s">&quot;hello_wor&quot;</span><span class="p" data-group-id="3322648802-2">)</span><span class="w">
</span><span class="p" data-group-id="3322648802-3">{</span><span class="ss">:local_or_var</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;hello_wor&#39;</span><span class="p" data-group-id="3322648802-3">}</span></code></pre><h2 id="cursor_context/2-return-values" class="section-heading">
  <a href="#cursor_context/2-return-values">
    <i class="ri-link-m" aria-hidden="true"></i>
    Return values
  </a>
</h2>
<ul><li><p><code class="inline">{:alias, charlist}</code> - the context is an alias, potentially
a nested one, such as <code class="inline">Hello.Wor</code> or <code class="inline">HelloWor</code></p></li><li><p><code class="inline">{:alias, inside_alias, charlist}</code> - the context is an alias, potentially
a nested one, where <code class="inline">inside_alias</code> is an expression <code class="inline">{:module_attribute, charlist}</code>
or <code class="inline">{:local_or_var, charlist}</code> and <code class="inline">charlist</code> is a static part
Examples are <code class="inline">__MODULE__.Submodule</code> or <code class="inline">@hello.Submodule</code></p></li><li><p><code class="inline">{:dot, inside_dot, charlist}</code> - the context is a dot
where <code class="inline">inside_dot</code> is either a <code class="inline">{:var, charlist}</code>, <code class="inline">{:alias, charlist}</code>,
<code class="inline">{:module_attribute, charlist}</code>, <code class="inline">{:unquoted_atom, charlist}</code> or a <code class="inline">dot</code>
itself. If a var is given, this may either be a remote call or a map
field access. Examples are <code class="inline">Hello.wor</code>, <code class="inline">:hello.wor</code>, <code class="inline">hello.wor</code>,
<code class="inline">Hello.nested.wor</code>, <code class="inline">hello.nested.wor</code>, and <code class="inline">@hello.world</code>. If <code class="inline">charlist</code>
is empty and <code class="inline">inside_dot</code> is an alias, then the autocompletion may either
be an alias or a remote call.</p></li><li><p><code class="inline">{:dot_arity, inside_dot, charlist}</code> - the context is a dot arity
where <code class="inline">inside_dot</code> is either a <code class="inline">{:var, charlist}</code>, <code class="inline">{:alias, charlist}</code>,
<code class="inline">{:module_attribute, charlist}</code>, <code class="inline">{:unquoted_atom, charlist}</code> or a <code class="inline">dot</code>
itself. If a var is given, it must be a remote arity. Examples are
<code class="inline">Hello.world/</code>, <code class="inline">:hello.world/</code>, <code class="inline">hello.world/2</code>, and <code class="inline">@hello.world/2</code></p></li><li><p><code class="inline">{:dot_call, inside_dot, charlist}</code> - the context is a dot
call. This means parentheses or space have been added after the expression.
where <code class="inline">inside_dot</code> is either a <code class="inline">{:var, charlist}</code>, <code class="inline">{:alias, charlist}</code>,
<code class="inline">{:module_attribute, charlist}</code>, <code class="inline">{:unquoted_atom, charlist}</code> or a <code class="inline">dot</code>
itself. If a var is given, it must be a remote call. Examples are
<code class="inline">Hello.world(</code>, <code class="inline">:hello.world(</code>, <code class="inline">Hello.world</code>, <code class="inline">hello.world(</code>, <code class="inline">hello.world</code>,
and <code class="inline">@hello.world(</code></p></li><li><p><code class="inline">:expr</code> - may be any expression. Autocompletion may suggest an alias,
local or var</p></li><li><p><code class="inline">{:local_or_var, charlist}</code> - the context is a variable or a local
(import or local) call, such as <code class="inline">hello_wor</code></p></li><li><p><code class="inline">{:local_arity, charlist}</code> - the context is a local (import or local)
arity, such as <code class="inline">hello_world/</code></p></li><li><p><code class="inline">{:local_call, charlist}</code> - the context is a local (import or local)
call, such as <code class="inline">hello_world(</code> and <code class="inline">hello_world</code></p></li><li><p><code class="inline">{:module_attribute, charlist}</code> - the context is a module attribute,
such as <code class="inline">@hello_wor</code></p></li><li><p><code class="inline">{:operator, charlist}</code> - the context is an operator, such as <code class="inline">+</code> or
<code class="inline">==</code>. Note textual operators, such as <code class="inline">when</code> do not appear as operators
but rather as <code class="inline">:local_or_var</code>. <code class="inline">@</code> is never an <code class="inline">:operator</code> and always a
<code class="inline">:module_attribute</code></p></li><li><p><code class="inline">{:operator_arity, charlist}</code> - the context is an operator arity, which
is an operator followed by /, such as <code class="inline">+/</code>, <code class="inline">not/</code> or <code class="inline">when/</code></p></li><li><p><code class="inline">{:operator_call, charlist}</code> - the context is an operator call, which is
an operator followed by space, such as <code class="inline">left +</code>, <code class="inline">not</code> or <code class="inline">x when</code></p></li><li><p><code class="inline">:none</code> - no context possible</p></li><li><p><code class="inline">{:sigil, charlist}</code> - the context is a sigil. It may be either the beginning
of a sigil, such as <code class="inline">~</code> or <code class="inline">~s</code>, or an operator starting with <code class="inline">~</code>, such as
<code class="inline">~&gt;</code> and <code class="inline">~&gt;&gt;</code></p></li><li><p><code class="inline">{:struct, inside_struct}</code> - the context is a struct, such as <code class="inline">%</code>, <code class="inline">%UR</code> or <code class="inline">%URI</code>.
<code class="inline">inside_struct</code> can either be a <code class="inline">charlist</code> in case of a static alias or an
expression <code class="inline">{:alias, inside_alias, charlist}</code>, <code class="inline">{:module_attribute, charlist}</code>,
<code class="inline">{:local_or_var, charlist}</code>, <code class="inline">{:dot, inside_dot, charlist}</code></p></li><li><p><code class="inline">{:unquoted_atom, charlist}</code> - the context is an unquoted atom. This
can be any atom or an atom representing a module</p></li></ul><h2 id="cursor_context/2-limitations" class="section-heading">
  <a href="#cursor_context/2-limitations">
    <i class="ri-link-m" aria-hidden="true"></i>
    Limitations
  </a>
</h2>
<p>The current algorithm only considers the last line of the input. This means
it will also show suggestions inside strings, heredocs, etc, which is
intentional as it helps with doctests, references, and more.</p>
  </section>
</section>
<section class="detail" id="surround_context/3">

    <span id="surround_context/2"></span>

  <div class="detail-header">
    <a href="#surround_context/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">surround_context(fragment, position, options \\ [])</h1>

      <a href="https://github.com/elixir-lang/elixir/blob/6407215fb97ca6699776db771accc9523f4e4a1f/lib/elixir/lib/code/fragment.ex#L578" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since 1.13.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> surround_context(<a href="List.Chars.html#t:t/0">List.Chars.t</a>(), <a href="#t:position/0">position</a>(), <a href="typespecs.html#built-in-types">keyword</a>()) ::
  %{begin: <a href="#t:position/0">position</a>(), end: <a href="#t:position/0">position</a>(), context: context} | :none
when context:
       {:alias, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:alias, inside_alias, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:dot, inside_dot, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:local_or_var, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:local_arity, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:local_call, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:module_attribute, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:operator, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:sigil, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:struct, inside_struct}
       | {:unquoted_atom, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:keyword, <a href="typespecs.html#built-in-types">charlist</a>()},
     inside_dot:
       {:alias, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:alias, inside_alias, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:dot, inside_dot, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:module_attribute, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:unquoted_atom, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:var, <a href="typespecs.html#built-in-types">charlist</a>()},
     inside_alias: {:local_or_var, <a href="typespecs.html#built-in-types">charlist</a>()} | {:module_attribute, <a href="typespecs.html#built-in-types">charlist</a>()},
     inside_struct:
       <a href="typespecs.html#built-in-types">charlist</a>()
       | {:alias, inside_alias, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:local_or_var, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:module_attribute, <a href="typespecs.html#built-in-types">charlist</a>()}
       | {:dot, inside_dot, <a href="typespecs.html#built-in-types">charlist</a>()}</pre>

      </div>

<p>Receives a string and returns the surround context.</p><p>This function receives a string with an Elixir code fragment
and a <code class="inline">position</code>. It returns a map containing the beginning
and ending of the identifier alongside its context, or <code class="inline">:none</code>
if there is nothing with a known context.</p><p>The difference between <a href="#cursor_context/2"><code class="inline">cursor_context/2</code></a> and <a href="#surround_context/3"><code class="inline">surround_context/3</code></a>
is that the former assumes the expression in the code fragment
is incomplete. For example, <code class="inline">do</code> in <a href="#cursor_context/2"><code class="inline">cursor_context/2</code></a> may be
a keyword or a variable or a local call, while <a href="#surround_context/3"><code class="inline">surround_context/3</code></a>
assumes the expression in the code fragment is complete, therefore
<code class="inline">do</code> would always be a keyword.</p><p>The <code class="inline">position</code> contains both the <code class="inline">line</code> and <code class="inline">column</code>, both starting
with the index of 1. The column must precede the surrounding expression.
For example, the expression <code class="inline">foo</code>, will return something for the columns
1, 2, and 3, but not 4:</p><pre><code class="makeup elixir" translate="no"><span class="n">foo</span><span class="w">
</span><span class="o">^</span><span class="w"> </span><span class="n">column</span><span class="w"> </span><span class="mi">1</span><span class="w">

</span><span class="n">foo</span><span class="w">
 </span><span class="o">^</span><span class="w"> </span><span class="n">column</span><span class="w"> </span><span class="mi">2</span><span class="w">

</span><span class="n">foo</span><span class="w">
  </span><span class="o">^</span><span class="w"> </span><span class="n">column</span><span class="w"> </span><span class="mi">3</span><span class="w">

</span><span class="n">foo</span><span class="w">
   </span><span class="o">^</span><span class="w"> </span><span class="n">column</span><span class="w"> </span><span class="mi">4</span></code></pre><p>The returned map contains the column the expression starts and the
first column after the expression ends.</p><p>Similar to <a href="#cursor_context/2"><code class="inline">cursor_context/2</code></a>, this function also provides a best-effort
detection and may not be accurate under all circumstances. See the
&quot;Return values&quot; and &quot;Limitations&quot; section under <a href="#cursor_context/2"><code class="inline">cursor_context/2</code></a> for
more information.</p><h2 id="surround_context/3-examples" class="section-heading">
  <a href="#surround_context/3-examples">
    <i class="ri-link-m" aria-hidden="true"></i>
    Examples
  </a>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="nc">Code.Fragment</span><span class="o">.</span><span class="n">surround_context</span><span class="p" data-group-id="6345239939-1">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6345239939-2">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="6345239939-2">}</span><span class="p" data-group-id="6345239939-1">)</span><span class="w">
</span><span class="p" data-group-id="6345239939-3">%{</span><span class="ss">begin</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6345239939-4">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="6345239939-4">}</span><span class="p">,</span><span class="w"> </span><span class="ss">context</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6345239939-5">{</span><span class="ss">:local_or_var</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;foo&#39;</span><span class="p" data-group-id="6345239939-5">}</span><span class="p">,</span><span class="w"> </span><span class="ss">end</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6345239939-6">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p" data-group-id="6345239939-6">}</span><span class="p" data-group-id="6345239939-3">}</span></code></pre><h2 id="surround_context/3-differences-to-cursor_context-2" class="section-heading">
  <a href="#surround_context/3-differences-to-cursor_context-2">
    <i class="ri-link-m" aria-hidden="true"></i>
    Differences to <a href="#cursor_context/2"><code class="inline">cursor_context/2</code></a>
  </a>
</h2>
<p>Because <a href="#surround_context/3"><code class="inline">surround_context/3</code></a> deals with complete code, it has some
difference to <a href="#cursor_context/2"><code class="inline">cursor_context/2</code></a>:</p><ul><li><p><code class="inline">dot_call</code>/<code class="inline">dot_arity</code> and <code class="inline">operator_call</code>/<code class="inline">operator_arity</code>
are collapsed into <code class="inline">dot</code> and <code class="inline">operator</code> contexts respectively
as there aren't any meaningful distinctions between them</p></li><li><p>On the other hand, this function still makes a distinction between
<code class="inline">local_call</code>/<code class="inline">local_arity</code> and <code class="inline">local_or_var</code>, since the latter can
be a local or variable</p></li><li><p><code class="inline">@</code> when not followed by any identifier is returned as <code class="inline">{:operator, '@'}</code>
(in contrast to <code class="inline">{:module_attribute, ''}</code> in <a href="#cursor_context/2"><code class="inline">cursor_context/2</code></a></p></li><li><p>This function never returns empty sigils <code class="inline">{:sigil, ''}</code> or empty structs
<code class="inline">{:struct, ''}</code> as context</p></li><li><p>This function returns keywords as <code class="inline">{:keyword, 'do'}</code></p></li><li><p>This function never returns <code class="inline">:expr</code></p></li></ul>
  </section>
</section>

    </div>
  </section>

      <footer class="footer">
        <p>

          <span class="line">
            <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
              Search HexDocs
            </button>

          </span>
        </p>

        <p class="built-using">
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.29.4) for the

            <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

        </p>
      </footer>
    </div>
  </div>
</section>
</div>


  </body>
</html>

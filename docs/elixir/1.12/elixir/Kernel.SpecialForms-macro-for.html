<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.24.1">
    <meta name="project" content="Elixir v1.12.0-rc.0">

    <title>Kernel.SpecialForms.for â€” Elixir v1.12.0-rc.0</title>
    <link rel="stylesheet" href="dist/elixir-a172fe91e725dcb259e2.css" />

      <link rel="canonical" href="https://hexdocs.pm/elixir/1.12/" />

    <script src="dist/sidebar_items-1a6c36a221.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/app-f27ff079945e43879c46.js"></script>


  </head>
  <body data-type="modules">
    <script>

      try {
        if (localStorage.getItem('night-mode') === 'true') {
          document.body.classList.add('night-mode');
        }
      } catch (error) { }
    </script>

<div class="main">

<button class="sidebar-button sidebar-toggle">
  <span class="icon-menu" title="Collapse/expand sidebar"></span>
</button>

<section class="sidebar">
  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <span class="icon-search" aria-hidden="true" title="Submit search"></span>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <span class="icon-cross" aria-hidden="true" title="Cancel search"></span>
    </button>
    <label class="search-label">
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">
    <div class="sidebar-projectDetails">
      <a href="https://elixir-lang.org/docs.html" class="sidebar-projectName">
Elixir
      </a>
      <strong class="sidebar-projectVersion">
        v1.12.0-rc.0
      </strong>
    </div>

  </div>

  <ul class="sidebar-listNav">
    <li><a id="extras-list-link" href="#full-list">Pages</a></li>

      <li><a id="modules-list-link" href="#full-list">Modules</a></li>


  </ul>
  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1>Kernel.SpecialForms.for</h1>

<div class="deprecated">
  You're seeing just the macro <code>for</code>, go back to <a href="Kernel.SpecialForms.html">Kernel.SpecialForms</a> module for more information.
</div>

<section class="detail" id="for/1">

  <div class="detail-header">
    <a href="#for/1" class="detail-link" title="Link to this macro">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this macro</span>
    </a>
    <h1 class="signature">for(args)</h1>

      <a href="https://github.com/elixir-lang/elixir/blob/fb151383ab866230694712690fe9a583dc32a9db/lib/elixir/lib/kernel/special_forms.ex#L1475" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(macro)</span>

  </div>

  <section class="docstring">

<p>Comprehensions allow you to quickly build a data structure from
an enumerable or a bitstring.</p><p>Let's start with an example:</p><pre><code class="makeup elixir"><span class="gp unselectable">iex&gt; </span><span class="k">for</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="3688405592-1">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p" data-group-id="3688405592-1">]</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="p" data-group-id="3688405592-2">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p" data-group-id="3688405592-2">]</span></code></pre><p>A comprehension accepts many generators and filters. Enumerable
generators are defined using <code class="inline">&lt;-</code>:</p><pre><code class="makeup elixir"><span class="c1"># A list generator:</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="k">for</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6157029288-1">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p" data-group-id="6157029288-1">]</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="p" data-group-id="6157029288-2">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p" data-group-id="6157029288-2">]</span><span class="w">

</span><span class="c1"># A comprehension with two generators</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6157029288-3">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="6157029288-3">]</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="6157029288-4">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6157029288-4">]</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="w">
</span><span class="p" data-group-id="6157029288-5">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p" data-group-id="6157029288-5">]</span></code></pre><p>Filters can also be given:</p><pre><code class="makeup elixir"><span class="c1"># A comprehension with a generator and a filter</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="k">for</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="4285111156-1">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p" data-group-id="4285111156-1">]</span><span class="p">,</span><span class="w"> </span><span class="n">rem</span><span class="p" data-group-id="4285111156-2">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4285111156-2">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">n</span><span class="w">
</span><span class="p" data-group-id="4285111156-3">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p" data-group-id="4285111156-3">]</span></code></pre><p>Generators can also be used to filter as it removes any value
that doesn't match the pattern on the left side of <code class="inline">&lt;-</code>:</p><pre><code class="makeup elixir"><span class="gp unselectable">iex&gt; </span><span class="n">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7927677357-1">[</span><span class="ss">user</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;john&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">admin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;meg&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">guest</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;barbara&quot;</span><span class="p" data-group-id="7927677357-1">]</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="k">for</span><span class="w"> </span><span class="p" data-group-id="7927677357-2">{</span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p" data-group-id="7927677357-2">}</span><span class="w"> </span><span class="ow">when</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="ss">:guest</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k" data-group-id="7927677357-3">do</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="nc">String</span><span class="o">.</span><span class="n">upcase</span><span class="p" data-group-id="7927677357-4">(</span><span class="n">name</span><span class="p" data-group-id="7927677357-4">)</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="k" data-group-id="7927677357-3">end</span><span class="w">
</span><span class="p" data-group-id="7927677357-5">[</span><span class="s">&quot;JOHN&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MEG&quot;</span><span class="p" data-group-id="7927677357-5">]</span></code></pre><p>Bitstring generators are also supported and are very useful when you
need to organize bitstring streams:</p><pre><code class="makeup elixir"><span class="gp unselectable">iex&gt; </span><span class="n">pixels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7255498794-1">&lt;&lt;</span><span class="mi">213</span><span class="p">,</span><span class="w"> </span><span class="mi">45</span><span class="p">,</span><span class="w"> </span><span class="mi">132</span><span class="p">,</span><span class="w"> </span><span class="mi">64</span><span class="p">,</span><span class="w"> </span><span class="mi">76</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">76</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">234</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p" data-group-id="7255498794-1">&gt;&gt;</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="k">for</span><span class="w"> </span><span class="p" data-group-id="7255498794-2">&lt;&lt;</span><span class="n">r</span><span class="o">::</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="o">::</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">::</span><span class="mi">8</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pixels</span><span class="p" data-group-id="7255498794-2">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7255498794-3">{</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p" data-group-id="7255498794-3">}</span><span class="w">
</span><span class="p" data-group-id="7255498794-4">[</span><span class="p" data-group-id="7255498794-5">{</span><span class="mi">213</span><span class="p">,</span><span class="w"> </span><span class="mi">45</span><span class="p">,</span><span class="w"> </span><span class="mi">132</span><span class="p" data-group-id="7255498794-5">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7255498794-6">{</span><span class="mi">64</span><span class="p">,</span><span class="w"> </span><span class="mi">76</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p" data-group-id="7255498794-6">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7255498794-7">{</span><span class="mi">76</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="7255498794-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7255498794-8">{</span><span class="mi">234</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p" data-group-id="7255498794-8">}</span><span class="p" data-group-id="7255498794-4">]</span></code></pre><p>Variable assignments inside the comprehension, be it in generators,
filters or inside the block, are not reflected outside of the
comprehension.</p><h2 id="for/1-the-into-and-uniq-options" class="section-heading">
  <a href="#for/1-the-into-and-uniq-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  The <code class="inline">:into</code> and <code class="inline">:uniq</code> options
</h2>
<p>In the examples above, the result returned by the comprehension was
always a list. The returned result can be configured by passing an
<code class="inline">:into</code> option, that accepts any structure as long as it implements
the <a href="Collectable.html"><code class="inline">Collectable</code></a> protocol.</p><p>For example, we can use bitstring generators with the <code class="inline">:into</code> option
to easily remove all spaces in a string:</p><pre><code class="makeup elixir"><span class="gp unselectable">iex&gt; </span><span class="k">for</span><span class="w"> </span><span class="p" data-group-id="8113921039-1">&lt;&lt;</span><span class="n">c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot; hello world &quot;</span><span class="p" data-group-id="8113921039-1">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="sc">?\s</span><span class="p">,</span><span class="w"> </span><span class="ss">into</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="8113921039-2">&lt;&lt;</span><span class="n">c</span><span class="p" data-group-id="8113921039-2">&gt;&gt;</span><span class="w">
</span><span class="s">&quot;helloworld&quot;</span></code></pre><p>The <a href="IO.html"><code class="inline">IO</code></a> module provides streams, that are both <a href="Enumerable.html"><code class="inline">Enumerable</code></a> and
<a href="Collectable.html"><code class="inline">Collectable</code></a>, here is an upcase echo server using comprehensions:</p><pre><code class="makeup elixir"><span class="k">for</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">IO</span><span class="o">.</span><span class="n">stream</span><span class="p" data-group-id="1090766939-1">(</span><span class="ss">:stdio</span><span class="p">,</span><span class="w"> </span><span class="ss">:line</span><span class="p" data-group-id="1090766939-1">)</span><span class="p">,</span><span class="w"> </span><span class="ss">into</span><span class="p">:</span><span class="w"> </span><span class="nc">IO</span><span class="o">.</span><span class="n">stream</span><span class="p" data-group-id="1090766939-2">(</span><span class="ss">:stdio</span><span class="p">,</span><span class="w"> </span><span class="ss">:line</span><span class="p" data-group-id="1090766939-2">)</span><span class="w"> </span><span class="k" data-group-id="1090766939-3">do</span><span class="w">
  </span><span class="nc">String</span><span class="o">.</span><span class="n">upcase</span><span class="p" data-group-id="1090766939-4">(</span><span class="n">line</span><span class="p" data-group-id="1090766939-4">)</span><span class="w">
</span><span class="k" data-group-id="1090766939-3">end</span></code></pre><p>Similarly, <code class="inline">uniq: true</code> can also be given to comprehensions to guarantee
the results are only added to the collection if they were not returned
before. For example:</p><pre><code class="makeup elixir"><span class="gp unselectable">iex&gt; </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p" data-group-id="9008691920-1">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9008691920-1">]</span><span class="p">,</span><span class="w"> </span><span class="ss">uniq</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="p" data-group-id="9008691920-2">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p" data-group-id="9008691920-2">]</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="k">for</span><span class="w"> </span><span class="p" data-group-id="9008691920-3">&lt;&lt;</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;abcabc&quot;</span><span class="p" data-group-id="9008691920-3">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="ss">uniq</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p">,</span><span class="w"> </span><span class="ss">into</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9008691920-4">&lt;&lt;</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">32</span><span class="p" data-group-id="9008691920-4">&gt;&gt;</span><span class="w">
</span><span class="s">&quot;ABC&quot;</span></code></pre><h2 id="for/1-the-reduce-option" class="section-heading">
  <a href="#for/1-the-reduce-option" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  The <code class="inline">:reduce</code> option
</h2>
<p>While the <code class="inline">:into</code> option allows us to customize the comprehension behaviour
to a given data type, such as putting all of the values inside a map or inside
a binary, it is not always enough.</p><p>For example, imagine that you have a binary with letters where you want to
count how many times each lowercase letter happens, ignoring all uppercase
ones. For instance, for the string <code class="inline">&quot;AbCabCABc&quot;</code>, we want to return the map
<code class="inline">%{&quot;a&quot; =&gt; 1, &quot;b&quot; =&gt; 2, &quot;c&quot; =&gt; 1}</code>.</p><p>If we were to use <code class="inline">:into</code>, we would need a data type that computes the
frequency of each element it holds. While there is no such data type in
Elixir, you could implement one yourself.</p><p>A simpler option would be to use comprehensions for the mapping and
filtering of letters, and then we invoke <a href="Enum.html#reduce/3"><code class="inline">Enum.reduce/3</code></a> to build a map,
for example:</p><pre><code class="makeup elixir"><span class="gp unselectable">iex&gt; </span><span class="n">letters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p" data-group-id="4765071545-1">&lt;&lt;</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;AbCabCABc&quot;</span><span class="p" data-group-id="4765071545-1">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="sc">?a</span><span class="o">.</span><span class="o">.</span><span class="sc">?z</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4765071545-2">&lt;&lt;</span><span class="n">x</span><span class="p" data-group-id="4765071545-2">&gt;&gt;</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="nc">Enum</span><span class="o">.</span><span class="n">reduce</span><span class="p" data-group-id="4765071545-3">(</span><span class="n">letters</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4765071545-4">%{</span><span class="p" data-group-id="4765071545-4">}</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="4765071545-5">fn</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">acc</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Map</span><span class="o">.</span><span class="n">update</span><span class="p" data-group-id="4765071545-6">(</span><span class="n">acc</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="ni">&amp;1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="4765071545-6">)</span><span class="w"> </span><span class="k" data-group-id="4765071545-5">end</span><span class="p" data-group-id="4765071545-3">)</span><span class="w">
</span><span class="p" data-group-id="4765071545-7">%{</span><span class="s">&quot;a&quot;</span><span class="w"> </span><span class="o">=</span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="w"> </span><span class="o">=</span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="w"> </span><span class="o">=</span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="4765071545-7">}</span></code></pre><p>While the above is straight-forward, it has the downside of traversing the
data at least twice. If you are expecting long strings as inputs, this can
be quite expensive.</p><p>Luckily, comprehensions also support the <code class="inline">:reduce</code> option, which would allow
us to fuse both steps above into a single step:</p><pre><code class="makeup elixir"><span class="gp unselectable">iex&gt; </span><span class="k">for</span><span class="w"> </span><span class="p" data-group-id="5763455183-1">&lt;&lt;</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;AbCabCABc&quot;</span><span class="p" data-group-id="5763455183-1">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="sc">?a</span><span class="o">.</span><span class="o">.</span><span class="sc">?z</span><span class="p">,</span><span class="w"> </span><span class="ss">reduce</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5763455183-2">%{</span><span class="p" data-group-id="5763455183-2">}</span><span class="w"> </span><span class="k" data-group-id="5763455183-3">do</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="n">acc</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Map</span><span class="o">.</span><span class="n">update</span><span class="p" data-group-id="5763455183-4">(</span><span class="n">acc</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5763455183-5">&lt;&lt;</span><span class="n">x</span><span class="p" data-group-id="5763455183-5">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="ni">&amp;1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="5763455183-4">)</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="k" data-group-id="5763455183-3">end</span><span class="w">
</span><span class="p" data-group-id="5763455183-6">%{</span><span class="s">&quot;a&quot;</span><span class="w"> </span><span class="o">=</span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="w"> </span><span class="o">=</span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="w"> </span><span class="o">=</span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="5763455183-6">}</span></code></pre><p>When the <code class="inline">:reduce</code> key is given, its value is used as the initial accumulator
and the <code class="inline">do</code> block must be changed to use <code class="inline">-&gt;</code> clauses, where the left side
of <code class="inline">-&gt;</code> receives the accumulated value of the previous iteration and the
expression on the right side must return the new accumulator value. Once there are no more
elements, the final accumulated value is returned. If there are no elements
at all, then the initial accumulator value is returned.</p>
  </section>
</section>


      <footer class="footer">
        <p>
          <span class="line">
            Built using
            <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener">ExDoc</a> (v0.24.1) for the
            <a href="https://elixir-lang.org" title="Elixir" target="_blank">Elixir programming language</a>.
          </span>
          <span class="line">
            Designed by
            <a href="https://twitter.com/dignifiedquire" target="_blank" rel="noopener" title="@dignifiedquire">Friedel Ziegelmayer</a>.
          </span>
        </p>
        <p>

            <a href="api-reference.html" title="API reference" class="line footer-button">API Reference</a>

          <button class="line footer-button display-shortcuts-help">
            Display keyboard shortcuts
          </button>
          <button class="line footer-button night-mode-toggle">
            Toggle night mode
          </button>
          <button class="line footer-button display-quick-switch">
            Go to a HexDocs package
          </button>
          <button class="line footer-button tooltips-toggle">
            <span class="tooltips-option-disable">Disable tooltips</span>
            <span class="tooltips-option-enable">Enable tooltips</span>
          </button>
        </p>
      </footer>
    </div>
  </div>
</section>
</div>


  </body>
</html>

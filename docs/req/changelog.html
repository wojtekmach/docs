<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.28.4">
    <meta name="project" content="req v0.3.0-dev">

    <title>CHANGELOG — req v0.3.0-dev</title>
    <link rel="stylesheet" href="dist/elixir-b6f1ed5df9b1d42a7309.css" />

    <script src="dist/sidebar_items-7c4eb7eafe.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/app-bd1cb213813bf4825aa2.js"></script>


  </head>
  <body data-type="extras">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">


<section class="sidebar">
  <button class="sidebar-button sidebar-toggle" aria-label="toggle sidebar">
    <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
  </button>

  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <i class="ri-search-2-line" aria-hidden="true" title="Submit search"></i>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <i class="ri-close-line ri-lg" aria-hidden="true" title="Cancel search"></i>
    </button>
    <label class="search-label">
      <p class="sr-only">Search</p>
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">

    <div class="sidebar-projectDetails">
      <a href="readme.html" class="sidebar-projectName" translate="no">
req
      </a>
      <strong class="sidebar-projectVersion" translate="no">
        v0.3.0-dev
      </strong>
    </div>
    <ul class="sidebar-listNav">
      <li><a id="extras-list-link" href="#full-list">Pages</a></li>

        <li><a id="modules-list-link" href="#full-list">Modules</a></li>


    </ul>
  </div>

  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1>
<button class="settings display-settings">
  <i class="ri-settings-3-line"></i>
  <span class="sr-only">Settings</span>
</button>


    <a href="https://github.com/wojtekmach/req/blob/v0.3.0-dev/CHANGELOG.md#L1" title="View Source" class="view-source" rel="help">
      <i class="ri-code-s-slash-line" aria-hidden="true"></i>
      <span class="sr-only">View Source</span>
    </a>

  <span>CHANGELOG</span>
</h1>

<h2 id="v0-3-0-dev" class="section-heading">
  <a href="#v0-3-0-dev" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">v0-3-0-dev</p>
  </a>
  v0.3.0-dev
</h2>
<p>Req v0.3.0 brings redesigned API, new steps, and improvements to existing steps.</p><h3 id="new-api" class="section-heading">
  <a href="#new-api" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">new-api</p>
  </a>
  New API
</h3>
<p>The new API allows building a request struct with all the built-in steps. It can be then piped
to functions like <a href="Req.html#get!/2"><code class="inline">Req.get!/2</code></a>:</p><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Req</span><span class="o">.</span><span class="n">new</span><span class="p" data-group-id="7717889207-1">(</span><span class="ss">base_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://api.github.com&quot;</span><span class="p" data-group-id="7717889207-1">)</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">req</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Req</span><span class="o">.</span><span class="n">get!</span><span class="p" data-group-id="7717889207-2">(</span><span class="ss">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/repos/sneako/finch&quot;</span><span class="p" data-group-id="7717889207-2">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">then</span><span class="p" data-group-id="7717889207-3">(</span><span class="o">&amp;</span><span class="w"> </span><span class="ni">&amp;1</span><span class="o">.</span><span class="n">body</span><span class="p" data-group-id="7717889207-4">[</span><span class="s">&quot;description&quot;</span><span class="p" data-group-id="7717889207-4">]</span><span class="p" data-group-id="7717889207-3">)</span><span class="w">
</span><span class="s">&quot;Elixir HTTP client, focused on performance&quot;</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">req</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Req</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="7717889207-5">(</span><span class="ss">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/repos/elixir-mint/mint&quot;</span><span class="p" data-group-id="7717889207-5">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">then</span><span class="p" data-group-id="7717889207-6">(</span><span class="o">&amp;</span><span class="w"> </span><span class="ni">&amp;1</span><span class="o">.</span><span class="n">body</span><span class="p" data-group-id="7717889207-7">[</span><span class="s">&quot;description&quot;</span><span class="p" data-group-id="7717889207-7">]</span><span class="p" data-group-id="7717889207-6">)</span><span class="w">
</span><span class="s">&quot;Functional HTTP client for Elixir with support for HTTP/1 and HTTP/2.&quot;</span></code></pre><p>Setting body and encoding it to form/JSON is now done through <code class="inline">:body/:form/:json</code> options:</p><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="nc">Req</span><span class="o">.</span><span class="n">post!</span><span class="p" data-group-id="7377513606-1">(</span><span class="s">&quot;https://httpbin.org/anything&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;hello!&quot;</span><span class="p" data-group-id="7377513606-1">)</span><span class="o">.</span><span class="n">body</span><span class="p" data-group-id="7377513606-2">[</span><span class="s">&quot;data&quot;</span><span class="p" data-group-id="7377513606-2">]</span><span class="w">
</span><span class="s">&quot;hello!&quot;</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="n">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Req</span><span class="o">.</span><span class="n">new</span><span class="p" data-group-id="7377513606-3">(</span><span class="ss">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://httpbin.org/anything&quot;</span><span class="p" data-group-id="7377513606-3">)</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="nc">Req</span><span class="o">.</span><span class="n">post!</span><span class="p" data-group-id="7377513606-4">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="ss">form</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7377513606-5">[</span><span class="ss">x</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="7377513606-5">]</span><span class="p" data-group-id="7377513606-4">)</span><span class="o">.</span><span class="n">body</span><span class="p" data-group-id="7377513606-6">[</span><span class="s">&quot;form&quot;</span><span class="p" data-group-id="7377513606-6">]</span><span class="w">
</span><span class="p" data-group-id="7377513606-7">%{</span><span class="s">&quot;x&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p" data-group-id="7377513606-7">}</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="nc">Req</span><span class="o">.</span><span class="n">post!</span><span class="p" data-group-id="7377513606-8">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="ss">json</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7377513606-9">%{</span><span class="ss">x</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="7377513606-9">}</span><span class="p" data-group-id="7377513606-8">)</span><span class="o">.</span><span class="n">body</span><span class="p" data-group-id="7377513606-10">[</span><span class="s">&quot;form&quot;</span><span class="p" data-group-id="7377513606-10">]</span><span class="w">
</span><span class="p" data-group-id="7377513606-11">%{</span><span class="s">&quot;x&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="7377513606-11">}</span></code></pre><h3 id="improved-error-handling" class="section-heading">
  <a href="#improved-error-handling" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">improved-error-handling</p>
  </a>
  Improved Error Handling
</h3>
<p>Req now validate option names ensuring users didn't accidentally mistyped them.
If that happened, it will try to give a helpful error message. Here are some examples:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Req</span><span class="o">.</span><span class="n">request!</span><span class="p" data-group-id="5558527246-1">(</span><span class="ss">urll</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://httpbin.org&quot;</span><span class="p" data-group-id="5558527246-1">)</span><span class="w">
</span><span class="gt">** (ArgumentError) unknown option :urll. Did you mean :url?</span><span class="w">

</span><span class="nc">Req</span><span class="o">.</span><span class="n">new</span><span class="p" data-group-id="5558527246-2">(</span><span class="ss">bas_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://httpbin.org&quot;</span><span class="p" data-group-id="5558527246-2">)</span><span class="w">
</span><span class="gt">** (ArgumentError) unknown option :bas_url. Did you mean :base_url?</span></code></pre><p>Req also has a new option to handle HTTP errors (4xx/5xx). By default it will continue to
return the error responses:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Req</span><span class="o">.</span><span class="n">get!</span><span class="p" data-group-id="0236544453-1">(</span><span class="s">&quot;https://httpbin.org/status/404&quot;</span><span class="p" data-group-id="0236544453-1">)</span><span class="w">
</span><span class="c1">#=&gt; %Req.Response{status: 404, ...}</span></code></pre><p>but users can now pass <code class="inline">http_errors: :raise</code> to raise an exception instead:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Req</span><span class="o">.</span><span class="n">get!</span><span class="p" data-group-id="1313471783-1">(</span><span class="s">&quot;https://httpbin.org/status/404&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">http_errors</span><span class="p">:</span><span class="w"> </span><span class="ss">:raise</span><span class="p" data-group-id="1313471783-1">)</span><span class="w">
</span><span class="gt">** (RuntimeError) The requested URL returned error: 404</span><span class="w">
</span><span class="nc">Response</span><span class="w"> </span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span></code></pre><p>This is especially useful in one-off scripts where we only really care about the
&quot;happy path&quot; but would still like to get a good error message when something
unexpected happened.</p><h3 id="plugins" class="section-heading">
  <a href="#plugins" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">plugins</p>
  </a>
  Plugins
</h3>
<p>From the very beginning, Req could be extended with custom steps. To make using such custom steps
by others even easier, they can be packaged up into plugins.</p><p>Here are some examples:</p><ul><li><a href="https://github.com/wojtekmach/req_easyhtml"><code class="inline">req_easyhtml</code></a></li><li><a href="https://github.com/wojtekmach/req_s3"><code class="inline">req_s3</code></a></li><li><a href="https://github.com/wojtekmach/req_hex"><code class="inline">req_hex</code></a></li><li><a href="https://github.com/wojtekmach/req_github_oauth"><code class="inline">req_github_oauth</code></a></li></ul><p>And here's how they can be used:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Mix</span><span class="o">.</span><span class="n">install</span><span class="p" data-group-id="3521451245-1">(</span><span class="p" data-group-id="3521451245-2">[</span><span class="w">
  </span><span class="p" data-group-id="3521451245-3">{</span><span class="ss">:req</span><span class="p">,</span><span class="w"> </span><span class="ss">github</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wojtekmach/req&quot;</span><span class="p" data-group-id="3521451245-3">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3521451245-4">{</span><span class="ss">:req_easyhtml</span><span class="p">,</span><span class="w"> </span><span class="ss">github</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wojtekmach/req_easyhtml&quot;</span><span class="p" data-group-id="3521451245-4">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3521451245-5">{</span><span class="ss">:req_s3</span><span class="p">,</span><span class="w"> </span><span class="ss">github</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wojtekmach/req_s3&quot;</span><span class="p" data-group-id="3521451245-5">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3521451245-6">{</span><span class="ss">:req_hex</span><span class="p">,</span><span class="w"> </span><span class="ss">github</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wojtekmach/req_hex&quot;</span><span class="p" data-group-id="3521451245-6">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="3521451245-7">{</span><span class="ss">:req_github_oauth</span><span class="p">,</span><span class="w"> </span><span class="ss">github</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wojtekmach/req_github_oauth&quot;</span><span class="p" data-group-id="3521451245-7">}</span><span class="w">
</span><span class="p" data-group-id="3521451245-2">]</span><span class="p" data-group-id="3521451245-1">)</span><span class="w">


</span><span class="n">req</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="p" data-group-id="3521451245-8">(</span><span class="nc">Req</span><span class="o">.</span><span class="n">new</span><span class="p" data-group-id="3521451245-9">(</span><span class="ss">http_errors</span><span class="p">:</span><span class="w"> </span><span class="ss">:raise</span><span class="p" data-group-id="3521451245-9">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">ReqEasyHTML</span><span class="o">.</span><span class="n">attach</span><span class="p" data-group-id="3521451245-10">(</span><span class="p" data-group-id="3521451245-10">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">ReqS3</span><span class="o">.</span><span class="n">attach</span><span class="p" data-group-id="3521451245-11">(</span><span class="p" data-group-id="3521451245-11">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">ReqHex</span><span class="o">.</span><span class="n">attach</span><span class="p" data-group-id="3521451245-12">(</span><span class="p" data-group-id="3521451245-12">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">ReqGitHubOAuth</span><span class="o">.</span><span class="n">attach</span><span class="p" data-group-id="3521451245-13">(</span><span class="p" data-group-id="3521451245-13">)</span><span class="p" data-group-id="3521451245-8">)</span><span class="w">

</span><span class="nc">Req</span><span class="o">.</span><span class="n">get!</span><span class="p" data-group-id="3521451245-14">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="ss">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://elixir-lang.org&quot;</span><span class="p" data-group-id="3521451245-14">)</span><span class="o">.</span><span class="n">body</span><span class="p" data-group-id="3521451245-15">[</span><span class="s">&quot;.entry-summary h5&quot;</span><span class="p" data-group-id="3521451245-15">]</span><span class="w">
</span><span class="c1">#=&gt;</span><span class="w">
</span><span class="c1"># #EasyHTML[&lt;h5&gt;</span><span class="w">
</span><span class="c1">#    Elixir is a dynamic, functional language for building scalable and maintainable applications.</span><span class="w">
</span><span class="c1">#  &lt;/h5&gt;]</span><span class="w">

</span><span class="nc">Req</span><span class="o">.</span><span class="n">get!</span><span class="p" data-group-id="3521451245-16">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="ss">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;s3://ossci-datasets&quot;</span><span class="p" data-group-id="3521451245-16">)</span><span class="o">.</span><span class="n">body</span><span class="w">
</span><span class="c1">#=&gt;</span><span class="w">
</span><span class="c1"># [</span><span class="w">
</span><span class="c1">#   &quot;mnist/&quot;,</span><span class="w">
</span><span class="c1">#   &quot;mnist/t10k-images-idx3-ubyte.gz&quot;,</span><span class="w">
</span><span class="c1">#   &quot;mnist/t10k-labels-idx1-ubyte.gz&quot;,</span><span class="w">
</span><span class="c1">#   &quot;mnist/train-images-idx3-ubyte.gz&quot;,</span><span class="w">
</span><span class="c1">#   &quot;mnist/train-labels-idx1-ubyte.gz&quot;</span><span class="w">
</span><span class="c1"># ]</span><span class="w">

</span><span class="nc">Req</span><span class="o">.</span><span class="n">get!</span><span class="p" data-group-id="3521451245-17">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="ss">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://repo.hex.pm/tarballs/req-0.1.0.tar&quot;</span><span class="p" data-group-id="3521451245-17">)</span><span class="o">.</span><span class="n">body</span><span class="p" data-group-id="3521451245-18">[</span><span class="s">&quot;metadata.config&quot;</span><span class="p" data-group-id="3521451245-18">]</span><span class="p" data-group-id="3521451245-19">[</span><span class="s">&quot;links&quot;</span><span class="p" data-group-id="3521451245-19">]</span><span class="w">
</span><span class="c1">#=&gt; %{&quot;GitHub&quot; =&gt; &quot;https://github.com/wojtekmach/req&quot;}</span><span class="w">

</span><span class="nc">Req</span><span class="o">.</span><span class="n">get!</span><span class="p" data-group-id="3521451245-20">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="ss">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://api.github.com/user&quot;</span><span class="p" data-group-id="3521451245-20">)</span><span class="o">.</span><span class="n">body</span><span class="p" data-group-id="3521451245-21">[</span><span class="s">&quot;login&quot;</span><span class="p" data-group-id="3521451245-21">]</span><span class="w">
</span><span class="c1"># Outputs:</span><span class="w">
</span><span class="c1"># paste this user code:</span><span class="w">
</span><span class="c1">#</span><span class="w">
</span><span class="c1">#   6C44-30A8</span><span class="w">
</span><span class="c1">#</span><span class="w">
</span><span class="c1"># at:</span><span class="w">
</span><span class="c1">#</span><span class="w">
</span><span class="c1">#   https://github.com/login/device</span><span class="w">
</span><span class="c1">#</span><span class="w">
</span><span class="c1"># open browser window? [Yn]</span><span class="w">
</span><span class="c1"># 15:22:28.350 [info] response: authorization_pending</span><span class="w">
</span><span class="c1"># 15:22:33.519 [info] response: authorization_pending</span><span class="w">
</span><span class="c1"># 15:22:38.678 [info] response: authorization_pending</span><span class="w">
</span><span class="c1">#=&gt; &quot;wojtekmach&quot;</span><span class="w">

</span><span class="nc">Req</span><span class="o">.</span><span class="n">get!</span><span class="p" data-group-id="3521451245-22">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="ss">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://api.github.com/user&quot;</span><span class="p" data-group-id="3521451245-22">)</span><span class="o">.</span><span class="n">body</span><span class="p" data-group-id="3521451245-23">[</span><span class="s">&quot;login&quot;</span><span class="p" data-group-id="3521451245-23">]</span><span class="w">
</span><span class="c1">#=&gt; &quot;wojtekmach&quot;</span></code></pre><p>Notice all plugins can be attached to the same request struct which makes it really easy to
explore different endpoints.</p><p>See <a href="https://wojtekmach.pl/docs/req/Req.Request.html#module-writing-plugins">&quot;Writing Plugins&quot; section in <code class="inline">Req.Request</code> module documentation</a>
for more information.</p><h3 id="plug-integration" class="section-heading">
  <a href="#plug-integration" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">plug-integration</p>
  </a>
  Plug Integration
</h3>
<p>Req can now be used to easily test plugs using the <code class="inline">:plug</code> option:</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">Echo</span><span class="w"> </span><span class="k" data-group-id="0734834962-1">do</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">call</span><span class="p" data-group-id="0734834962-2">(</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="p" data-group-id="0734834962-2">)</span><span class="w"> </span><span class="k" data-group-id="0734834962-3">do</span><span class="w">
    </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="o">.</span><span class="n">request_path</span><span class="w">
    </span><span class="nc">Plug.Conn</span><span class="o">.</span><span class="n">send_resp</span><span class="p" data-group-id="0734834962-4">(</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p" data-group-id="0734834962-4">)</span><span class="w">
  </span><span class="k" data-group-id="0734834962-3">end</span><span class="w">
</span><span class="k" data-group-id="0734834962-1">end</span><span class="w">

</span><span class="n">test</span><span class="w"> </span><span class="s">&quot;echo&quot;</span><span class="w"> </span><span class="k" data-group-id="0734834962-5">do</span><span class="w">
  </span><span class="n">assert</span><span class="w"> </span><span class="nc">Req</span><span class="o">.</span><span class="n">get!</span><span class="p" data-group-id="0734834962-6">(</span><span class="s">&quot;http:///hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">plug</span><span class="p">:</span><span class="w"> </span><span class="nc">Echo</span><span class="p" data-group-id="0734834962-6">)</span><span class="o">.</span><span class="n">body</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;hello&quot;</span><span class="w">
</span><span class="k" data-group-id="0734834962-5">end</span></code></pre><h3 id="request-adapters" class="section-heading">
  <a href="#request-adapters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">request-adapters</p>
  </a>
  Request Adapters
</h3>
<p>While Req always used Finch as the underlying HTTP client, it was designed from the day one to
easily swap it out. This is now even easier with an <code class="inline">:adapter</code> option.</p><p>Here is a mock adapter that always returns a successful response:</p><pre><code class="makeup elixir" translate="no"><span class="n">adapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="4761931377-1">fn</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4761931377-2">%</span><span class="nc" data-group-id="4761931377-2">Req.Response</span><span class="p" data-group-id="4761931377-2">{</span><span class="ss">status</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;it works!&quot;</span><span class="p" data-group-id="4761931377-2">}</span><span class="w">
  </span><span class="p" data-group-id="4761931377-3">{</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p" data-group-id="4761931377-3">}</span><span class="w">
</span><span class="k" data-group-id="4761931377-1">end</span><span class="w">

</span><span class="nc">Req</span><span class="o">.</span><span class="n">request!</span><span class="p" data-group-id="4761931377-4">(</span><span class="ss">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://example&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">adapter</span><span class="p">:</span><span class="w"> </span><span class="n">adapter</span><span class="p" data-group-id="4761931377-4">)</span><span class="o">.</span><span class="n">body</span><span class="w">
</span><span class="c1">#=&gt; &quot;it works!&quot;</span></code></pre><p>And here is a naive Hackney-based adapter and how we can use it:</p><pre><code class="makeup elixir" translate="no"><span class="n">hackney</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="7086637110-1">fn</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="k">case</span><span class="w"> </span><span class="nc">:hackney</span><span class="o">.</span><span class="n">request</span><span class="p" data-group-id="7086637110-2">(</span><span class="w">
         </span><span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="p">,</span><span class="w">
         </span><span class="nc">URI</span><span class="o">.</span><span class="n">to_string</span><span class="p" data-group-id="7086637110-3">(</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p" data-group-id="7086637110-3">)</span><span class="p">,</span><span class="w">
         </span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span><span class="w">
         </span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">,</span><span class="w">
         </span><span class="p" data-group-id="7086637110-4">[</span><span class="ss">:with_body</span><span class="p" data-group-id="7086637110-4">]</span><span class="w">
       </span><span class="p" data-group-id="7086637110-2">)</span><span class="w"> </span><span class="k" data-group-id="7086637110-5">do</span><span class="w">
    </span><span class="p" data-group-id="7086637110-6">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">headers</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="p" data-group-id="7086637110-6">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="n">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p" data-group-id="7086637110-7">{</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p" data-group-id="7086637110-7">}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">headers</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7086637110-8">{</span><span class="nc">String</span><span class="o">.</span><span class="n">downcase</span><span class="p" data-group-id="7086637110-9">(</span><span class="n">name</span><span class="p" data-group-id="7086637110-9">)</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p" data-group-id="7086637110-8">}</span><span class="w">
      </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7086637110-10">%</span><span class="nc" data-group-id="7086637110-10">Req.Response</span><span class="p" data-group-id="7086637110-10">{</span><span class="ss">status</span><span class="p">:</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="ss">headers</span><span class="p">:</span><span class="w"> </span><span class="n">headers</span><span class="p">,</span><span class="w"> </span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="n">body</span><span class="p" data-group-id="7086637110-10">}</span><span class="w">
      </span><span class="p" data-group-id="7086637110-11">{</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p" data-group-id="7086637110-11">}</span><span class="w">

    </span><span class="p" data-group-id="7086637110-12">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p" data-group-id="7086637110-12">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="p" data-group-id="7086637110-13">{</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="nc">RuntimeError</span><span class="o">.</span><span class="n">exception</span><span class="p" data-group-id="7086637110-14">(</span><span class="n">inspect</span><span class="p" data-group-id="7086637110-15">(</span><span class="n">reason</span><span class="p" data-group-id="7086637110-15">)</span><span class="p" data-group-id="7086637110-14">)</span><span class="p" data-group-id="7086637110-13">}</span><span class="w">
  </span><span class="k" data-group-id="7086637110-5">end</span><span class="w">
</span><span class="k" data-group-id="7086637110-1">end</span><span class="w">

</span><span class="nc">Req</span><span class="o">.</span><span class="n">get!</span><span class="p" data-group-id="7086637110-16">(</span><span class="s">&quot;https://api.github.com/repos/elixir-lang/elixir&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">adapter</span><span class="p">:</span><span class="w"> </span><span class="n">hackney</span><span class="p" data-group-id="7086637110-16">)</span><span class="o">.</span><span class="n">body</span><span class="p" data-group-id="7086637110-17">[</span><span class="s">&quot;description&quot;</span><span class="p" data-group-id="7086637110-17">]</span><span class="w">
</span><span class="c1">#=&gt; &quot;Elixir is a dynamic, functional language designed for building scalable and maintainable applications&quot;</span></code></pre><p>See &quot;Adapter&quot; seciton in <a href="Req.Request.html"><code class="inline">Req.Request</code></a> module documentation for more information.</p><h3 id="major-changes" class="section-heading">
  <a href="#major-changes" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">major-changes</p>
  </a>
  Major changes
</h3>
<ul><li><p>Add high-level functional API: <code class="inline">Req.new(...) |&gt; Req.request(...)</code>, <code class="inline">Req.new(...) |&gt; Req.get!(...)</code>, etc.</p></li><li><p>Add <code class="inline">Req.Request.options</code> field that steps can read from. Also, make
all steps be arity 1.</p><p>When using &quot;High-level&quot; API, we now run all steps by default. (The
steps, by looking at request.options, can decide to be no-op.)</p></li><li><p>Move low-level API to <a href="Req.Request.html"><code class="inline">Req.Request</code></a></p></li><li><p>Move built-in steps to <a href="Req.Steps.html"><code class="inline">Req.Steps</code></a></p></li><li><p>Add step names</p></li><li><p>Add <a href="Req.html#head!/2"><code class="inline">Req.head!/2</code></a></p></li><li><p>Add <a href="Req.html#patch!/2"><code class="inline">Req.patch!/2</code></a></p></li><li><p>Add <code class="inline">Req.Request.adapter</code> field</p></li><li><p>Add <a href="Req.Request.html#merge_options/2"><code class="inline">Req.Request.merge_options/2</code></a></p></li><li><p>Add <a href="Req.Request.html#register_options/2"><code class="inline">Req.Request.register_options/2</code></a></p></li><li><p>Add <a href="Req.Request.html#put_header/3"><code class="inline">Req.Request.put_header/3</code></a></p></li><li><p>Add <a href="Req.Request.html#get_header/2"><code class="inline">Req.Request.get_header/2</code></a></p></li><li><p>Add <a href="Req.Response.html#get_header/2"><code class="inline">Req.Response.get_header/2</code></a></p></li><li><p>Add <a href="Req.Response.html#put_header/3"><code class="inline">Req.Response.put_header/3</code></a></p></li><li><p>Rename <code class="inline">put_if_modified_since</code> step to <code class="inline">cache</code></p></li><li><p>Rename <code class="inline">decompress</code> step to <code class="inline">decompress_body</code></p></li><li><p>Remove <code class="inline">put_default_steps</code> step</p></li><li><p>Remove <code class="inline">run_steps</code> step</p></li><li><p>Remove <code class="inline">put_default_headers</code> step</p></li><li><p>Remove <code class="inline">encode_headers</code> step. The headers are now encoded in <a href="Req.html#new/1"><code class="inline">Req.new/1</code></a> and <a href="Req.html#request/2"><code class="inline">Req.request/2</code></a></p></li><li><p>Remove <code class="inline">Req.Request.unix_socket</code> field. Add option on <code class="inline">run_finch</code> step with the same name
instead.</p></li></ul><h3 id="step-changes" class="section-heading">
  <a href="#step-changes" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">step-changes</p>
  </a>
  Step changes
</h3>
<ul><li><p><code class="inline">put_base_url</code>: Ignore base URL if given URL contains scheme</p></li><li><p><code class="inline">run_finch</code>: Add <code class="inline">:http2</code> option that picks appropriate default pool started by
Req</p></li><li><p><code class="inline">encode_body</code>: Add <code class="inline">:form</code> and <code class="inline">:json</code> options (previously used as <code class="inline">{:form, data}</code> and
<code class="inline">{:json, data}</code>)</p></li><li><p><code class="inline">cache</code>: Include request method in cache key</p></li><li><p><code class="inline">decompress_body</code>: Support Brotli</p></li><li><p><code class="inline">decode_body</code>: Support <code class="inline">decode_body: false</code> option to disable automatic body decoding</p></li><li><p><code class="inline">follow_redirects</code>: Change method to GET on 301..303 redirects</p></li><li><p><code class="inline">follow_redirects</code>: Don't send auth headers on redirect to different scheme/host/port
unless <code class="inline">location_trusted: true</code> is set</p></li><li><p><code class="inline">retry</code>: The <code class="inline">:retry</code> option can now be set to <code class="inline">:safe</code> (default) to only retry GET/HEAD
requests on HTTP 408/5xx responses or exceptions, <code class="inline">:always</code> to always retry, <code class="inline">:never</code> to never
retry, and <code class="inline">fun</code> - a 1-arity function that accepts either a <a href="Req.Response.html"><code class="inline">Req.Response</code></a> or an exception
struct and returns boolean whether to retry</p></li><li><p>New step: <code class="inline">run_plug</code></p></li><li><p>New step: <code class="inline">put_user_agent</code> (replaces part of removed <code class="inline">put_default_headers</code>)</p></li><li><p>New step: <code class="inline">compressed</code> (replaces part of removed <code class="inline">put_default_headers</code>)</p></li><li><p>New step: <code class="inline">compress_body</code></p></li><li><p>New step: <code class="inline">output</code></p></li><li><p>New step: <code class="inline">handle_http_errors</code></p></li></ul><h3 id="deprecations" class="section-heading">
  <a href="#deprecations" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">deprecations</p>
  </a>
  Deprecations
</h3>
<ul><li><p>Deprecate calling <code class="inline">Req.post!(url, body)</code> in favour of <code class="inline">Req.post!(url, body: body)</code>.
Also, deprecate <code class="inline">Req.post!(url, {:form, data})</code> in favour of <code class="inline">Req.post!(url, form: data)</code>.
and <code class="inline">Req.post!(url, {:json, data})</code> in favour of <code class="inline">Req.post!(url, json: data)</code>. Same for
<a href="Req.html#put!/2"><code class="inline">Req.put!/2</code></a>.</p></li><li><p>Deprecate setting <code class="inline">retry: [delay: delay, max_retries: max_retries]</code>
in favour of <code class="inline">retry_delay: delay, max_retries: max_retries</code>.</p></li><li><p>Deprecate setting <code class="inline">cache: [dir: dir]</code> in favour of <code class="inline">cache_dir: dir</code>.</p></li><li><p>Deprecate Req.build/3 in favour of manually building the struct.</p></li></ul><h2 id="v0-2-2-2022-04-04" class="section-heading">
  <a href="#v0-2-2-2022-04-04" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">v0-2-2-2022-04-04</p>
  </a>
  v0.2.2 (2022-04-04)
</h2>
<ul><li>Relax Finch version requirement</li></ul><h2 id="v0-2-1-2021-11-24" class="section-heading">
  <a href="#v0-2-1-2021-11-24" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">v0-2-1-2021-11-24</p>
  </a>
  v0.2.1 (2021-11-24)
</h2>
<ul><li>Add <code class="inline">:private</code> field to Response</li><li>Update Finch to 0.9.1</li></ul><h2 id="v0-2-0-2021-11-08" class="section-heading">
  <a href="#v0-2-0-2021-11-08" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">v0-2-0-2021-11-08</p>
  </a>
  v0.2.0 (2021-11-08)
</h2>
<ul><li>Rename <code class="inline">normalize_headers</code> to <code class="inline">encode_headers</code></li><li>Rename <code class="inline">prepend_default_steps</code> to <code class="inline">put_default_steps</code></li><li>Rename <code class="inline">encode</code> and <code class="inline">decode</code> to <code class="inline">encode_body</code> and <code class="inline">decode_body</code></li><li>Rename <code class="inline">netrc</code> to <code class="inline">load_netrc</code></li><li>Rename <code class="inline">finch</code> step to <code class="inline">run_finch</code></li><li>Rename <code class="inline">if_modified_since</code> to <code class="inline">put_if_modified_since</code></li><li>Rename <code class="inline">range</code> to <code class="inline">put_range</code></li><li>Rename <code class="inline">params</code> to <code class="inline">put_params</code></li><li>Rename <code class="inline">request.uri</code> to <code class="inline">request.url</code></li><li>Change response/error step contract from <code class="inline">f(req, resp_err)</code> to <code class="inline">f({req, resp_err})</code></li><li>Support mime 2.x</li><li>Add <a href="Req.Response.html"><code class="inline">Req.Response</code></a> struct</li><li>Add <code class="inline">put!/3</code> and <code class="inline">delete!/2</code></li><li>Add <code class="inline">run_steps/2</code></li><li>Initial support for UNIX domain sockets</li><li>Accept <code class="inline">{module, args}</code> and <code class="inline">module</code> as steps</li><li>Ensure <code class="inline">get_private</code> and <code class="inline">put_private</code> have atom keys</li><li><code class="inline">put_default_steps</code>: Use MFArgs instead of captures for the default steps</li><li><code class="inline">put_if_modified_since</code>: Fix generating internet time</li><li><code class="inline">encode_headers</code>: Encode header values</li><li><code class="inline">retry</code>: Rename <code class="inline">:max_attempts</code> to <code class="inline">:max_retries</code></li></ul><h2 id="v0-1-1-2021-07-16" class="section-heading">
  <a href="#v0-1-1-2021-07-16" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">v0-1-1-2021-07-16</p>
  </a>
  v0.1.1 (2021-07-16)
</h2>
<ul><li>Fix <code class="inline">append_request_steps/2</code> and <code class="inline">prepend_request_steps/2</code> (they did the opposite)</li><li>Add <code class="inline">finch/1</code></li></ul><h2 id="v0-1-0-2021-07-15" class="section-heading">
  <a href="#v0-1-0-2021-07-15" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">v0-1-0-2021-07-15</p>
  </a>
  v0.1.0 (2021-07-15)
</h2>
<ul><li>Initial release</li></ul>
<div class="bottom-actions">
  <div class="bottom-actions-item">

      <a href="readme.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Req
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

  </div>
</div>

      <footer class="footer">

          <p>
            On Hex.pm:

            <span class="line">
              <a href="https://hex.pm/packages/req/0.3.0-dev" class="line footer-hex-package">Package</a>
              <a href="https://preview.hex.pm/preview/req/0.3.0-dev" class="line">Preview</a>

                <a href="https://preview.hex.pm/preview/req/0.3.0-dev/show/CHANGELOG.md">(current file)</a>

            </span>

            <button class="line footer-button display-quick-switch">
              Search
            </button>
          </p>

        <p>
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.28.4) for the

            <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

        </p>
      </footer>
    </div>
  </div>
</section>
</div>


  </body>
</html>
